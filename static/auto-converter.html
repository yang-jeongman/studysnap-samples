<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™„ì „ ìë™í™” ì„ ê±°ê³µë³´ë¬¼ ë³€í™˜ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .auto-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10B981, #059669);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.5em;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: #fafafa;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.has-file {
            border-color: #10B981;
            background: #ecfdf5;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: #666;
            font-size: 0.95em;
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-info .icon {
            font-size: 2em;
        }

        .file-info .details {
            flex: 1;
            text-align: left;
        }

        .file-info .name {
            font-weight: 600;
            color: #333;
        }

        .file-info .size {
            color: #666;
            font-size: 0.9em;
        }

        .file-info .remove {
            background: #fee2e2;
            color: #dc2626;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        /* Convert Button */
        .convert-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .convert-btn.ready {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .convert-btn.ready:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .convert-btn.disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .convert-btn.loading {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        /* Progress */
        .progress-container {
            display: none;
            margin-top: 20px;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-weight: 500;
        }

        /* Result */
        .result-container {
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-success {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-success h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .result-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
        }

        .result-item .label {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .result-item .value {
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 3px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .result-actions a, .result-actions button {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-size: 1em;
        }

        .btn-preview {
            background: #667eea;
            color: white;
        }

        .btn-preview:hover {
            background: #5a67d8;
        }

        .btn-download {
            background: #10B981;
            color: white;
        }

        .btn-download:hover {
            background: #059669;
        }

        .btn-reset {
            background: #6b7280;
            color: white;
        }

        .btn-reset:hover {
            background: #4b5563;
        }

        /* Features List */
        .features-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .feature-item .icon {
            font-size: 1.5em;
        }

        .feature-item .text {
            font-weight: 500;
            color: #333;
        }

        /* Party Colors */
        .party-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .party-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9em;
        }

        .party-chip .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Status */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: #f0f9ff;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        .status-dot.ready {
            background: #10B981;
        }

        .status-dot.error {
            background: #EF4444;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Error */
        .error-container {
            display: none;
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .error-container.show {
            display: block;
        }

        /* Batch Mode */
        .batch-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .batch-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        /* ì €ì¥ ê²½ë¡œ ì„ íƒ */
        .save-path-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .save-path-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .folder-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .folder-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .folder-option.selected {
            border-color: #667eea;
            background: #e8efff;
        }

        .folder-option input[type="radio"] {
            display: none;
        }

        .folder-option .folder-icon {
            font-size: 1.5em;
        }

        .folder-option .folder-info {
            flex: 1;
        }

        .folder-option .folder-name {
            font-weight: 600;
            color: #333;
        }

        .folder-option .folder-desc {
            font-size: 0.8em;
            color: #666;
        }

        .custom-folder-input {
            display: none;
            margin-top: 15px;
        }

        .custom-folder-input.show {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .custom-folder-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
        }

        .custom-folder-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .existing-folders {
            margin-top: 15px;
        }

        .existing-folders-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .existing-folders-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .existing-folder-chip {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .existing-folder-chip:hover {
            background: #e8efff;
            border-color: #667eea;
        }

        .existing-folder-chip.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav style="max-width: 900px; margin: 0 auto 15px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
        <a href="/static/explorer.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #1e3c72; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">ğŸ—‚ï¸ íƒìƒ‰ê¸°</a>
        <a href="/static/files.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #667eea; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">ğŸ“ íŒŒì¼</a>
        <a href="/static/editor.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #E11D48; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">âœï¸ ì—ë””í„°</a>
        <a href="/static/server-manager.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #28a745; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">ğŸ–¥ï¸ ì„œë²„</a>
        <a href="/static/terminal.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #6f42c1; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">ğŸ’» í„°ë¯¸ë„</a>
    </nav>

    <div class="container">
        <header class="header">
            <h1>
                <span class="auto-badge">AUTO</span>
                ì„ ê±°ê³µë³´ë¬¼ ì™„ì „ ìë™ ë³€í™˜ê¸°
            </h1>
            <p>PDF ì—…ë¡œë“œë§Œ í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë°”ì¼ ìµœì í™” í˜ì´ì§€ ìƒì„±</p>
        </header>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <span class="status-dot ready" id="statusDot"></span>
                <span id="statusText">ì‹œìŠ¤í…œ ì¤€ë¹„ë¨</span>
            </div>
            <span id="visionStatus">Vision OCR: í™•ì¸ ì¤‘...</span>
        </div>

        <!-- Upload Card -->
        <div class="card">
            <h2 class="card-title">ğŸ“¤ PDF ì—…ë¡œë“œ</h2>

            <div class="batch-toggle">
                <input type="checkbox" id="batchMode">
                <label for="batchMode">ë‹¤ì¤‘ íŒŒì¼ ì¼ê´„ ë³€í™˜ ëª¨ë“œ</label>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“„</div>
                <h3>ì„ ê±°ê³µë³´ë¬¼ PDFë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</h3>
                <p>ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                <input type="file" id="fileInput" class="file-input" accept=".pdf" multiple>
            </div>

            <div id="fileList"></div>

            <!-- ì €ì¥ ê²½ë¡œ ì„ íƒ -->
            <div class="save-path-section">
                <div class="save-path-title">ğŸ“ ì €ì¥ ê²½ë¡œ ì„ íƒ</div>
                <div class="folder-select-grid">
                    <label class="folder-option selected" data-folder="">
                        <input type="radio" name="saveFolder" value="" checked>
                        <span class="folder-icon">ğŸ“„</span>
                        <div class="folder-info">
                            <div class="folder-name">ê¸°ë³¸ (outputs)</div>
                            <div class="folder-desc">outputs í´ë”ì— ì €ì¥</div>
                        </div>
                    </label>
                    <label class="folder-option" data-folder="custom">
                        <input type="radio" name="saveFolder" value="custom">
                        <span class="folder-icon">â•</span>
                        <div class="folder-info">
                            <div class="folder-name">ìƒˆ í´ë” ìƒì„±</div>
                            <div class="folder-desc">ìƒˆ í´ë” + images í´ë”</div>
                        </div>
                    </label>
                </div>

                <!-- ìƒˆ í´ë” ì…ë ¥ (ì •ë‹¹/í›„ë³´ìëª… êµ¬ì¡°) -->
                <div class="custom-folder-input" id="customFolderInput">
                    <div style="display: flex; align-items: center; gap: 5px; flex-wrap: wrap;">
                        <span>outputs/</span>
                        <select id="partyFolderSelect" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="">ì •ë‹¹ ì„ íƒ</option>
                            <option value="Minjoo">ë¯¼ì£¼ë‹¹ (Minjoo)</option>
                            <option value="PPP">êµ­ë¯¼ì˜í˜ (PPP)</option>
                            <option value="Other">ê¸°íƒ€</option>
                        </select>
                        <span>/</span>
                        <input type="text" id="candidateFolderName" placeholder="í›„ë³´ìëª… (ì˜ˆ: ì´ê´‘ì¬)" style="flex: 1; min-width: 100px;">
                    </div>
                    <div id="customPartyInput" style="display: none; margin-top: 10px;">
                        <input type="text" id="customPartyName" placeholder="ì •ë‹¹ í´ë”ëª… ì§ì ‘ ì…ë ¥" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <button type="button" onclick="validateNewFolder()" style="margin-top: 10px; padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; width: 100%;">í™•ì¸</button>
                </div>
                <div id="newFolderPreview" style="display: none; margin-top: 10px; padding: 12px 15px; background: #e8f5e9; border-radius: 8px; font-size: 0.9em;">
                    <div style="color: #2e7d32; font-weight: 500;">âœ… ìƒì„±ë  í´ë” êµ¬ì¡°:</div>
                    <div style="margin-top: 5px; font-family: monospace; color: #333;">
                        ğŸ“ outputs/<span id="previewPartyName">ì •ë‹¹</span>/<span id="previewCandidateName">í›„ë³´ìëª…</span>/<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ ğŸ“„ [í›„ë³´ìëª…].html<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;â””â”€ ğŸ“ images/ (ì´ë¯¸ì§€ ì—…ë¡œë“œìš©)
                    </div>
                </div>

                <!-- ê¸°ì¡´ í´ë” ëª©ë¡ -->
                <div class="existing-folders" id="existingFolders">
                    <div class="existing-folders-title">ğŸ“‚ ê¸°ì¡´ í´ë” ì„ íƒ:</div>
                    <div class="existing-folders-list" id="existingFoldersList">
                        <span style="color: #999; font-size: 0.9em;">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
            </div>

            <button class="convert-btn disabled" id="convertBtn" disabled>
                <span>ğŸ“„ PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </button>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
            </div>

            <div class="error-container" id="errorContainer"></div>
        </div>

        <!-- Result Card -->
        <div class="card result-container" id="resultContainer">
            <div class="result-success">
                <h3>ë³€í™˜ ì™„ë£Œ!</h3>
                <div class="result-info" id="resultInfo"></div>
            </div>
            <div class="result-actions">
                <a href="#" class="btn-preview" id="previewBtn" target="_blank">ë¯¸ë¦¬ë³´ê¸°</a>
                <a href="#" class="btn-download" id="downloadBtn" download>HTML ë‹¤ìš´ë¡œë“œ</a>
                <a href="#" class="btn-download" id="downloadFolderBtn" style="background: #28a745; display: none;">í´ë” ZIP ë‹¤ìš´ë¡œë“œ</a>
                <button class="btn-reset" id="resetBtn">ìƒˆë¡œ ë³€í™˜</button>
            </div>
        </div>

        <!-- Features Card -->
        <div class="card">
            <h2 class="card-title">ìë™í™” ê¸°ëŠ¥</h2>
            <div class="features-list">
                <div class="feature-item">
                    <span class="icon">ğŸ¨</span>
                    <span class="text">ì •ë‹¹ë³„ í…Œë§ˆ ìë™ ì ìš©</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ‘¤</span>
                    <span class="text">í›„ë³´ì ì •ë³´ ìë™ ì¶”ì¶œ</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“‹</span>
                    <span class="text">ê³µì•½ ìë™ êµ¬ì¡°í™”</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“±</span>
                    <span class="text">ëª¨ë°”ì¼ ìµœì í™”</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ”—</span>
                    <span class="text">SNS ë§í¬ ìë™ ì—°ê²°</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“</span>
                    <span class="text">ì „í™”ë²ˆí˜¸ í´ë¦­ í†µí™”</span>
                </div>
            </div>

            <h3 style="margin-top: 25px; margin-bottom: 10px; color: #666;">ì§€ì› ì •ë‹¹</h3>
            <div class="party-colors" id="partyColors"></div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const convertBtn = document.getElementById('convertBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const resultContainer = document.getElementById('resultContainer');
        const errorContainer = document.getElementById('errorContainer');
        const batchMode = document.getElementById('batchMode');

        let selectedFiles = [];
        let selectedSaveFolder = '';  // ì €ì¥í•  í•˜ìœ„ í´ë”

        // í´ë” ì„ íƒ ì´ë²¤íŠ¸
        document.querySelectorAll('.folder-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.folder-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;

                const folderValue = this.dataset.folder;
                const customInput = document.getElementById('customFolderInput');

                if (folderValue === 'custom') {
                    customInput.classList.add('show');
                    selectedSaveFolder = document.getElementById('customFolderName').value.trim();
                } else {
                    customInput.classList.remove('show');
                    selectedSaveFolder = folderValue;
                }

                // ê¸°ì¡´ í´ë” ì„ íƒ í•´ì œ
                document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            });
        });

        // ì •ë‹¹ ì„ íƒ ë³€ê²½ ì‹œ
        document.getElementById('partyFolderSelect').addEventListener('change', function() {
            const customPartyInput = document.getElementById('customPartyInput');
            if (this.value === 'Other') {
                customPartyInput.style.display = 'block';
            } else {
                customPartyInput.style.display = 'none';
            }
            // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€ (ì¬í™•ì¸ í•„ìš”)
            document.getElementById('newFolderPreview').style.display = 'none';
        });

        // í›„ë³´ìëª… ì…ë ¥ ì‹œ
        document.getElementById('candidateFolderName').addEventListener('input', function() {
            // ê¸°ì¡´ í´ë” ì„ íƒ í•´ì œ
            document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€ (ì¬í™•ì¸ í•„ìš”)
            document.getElementById('newFolderPreview').style.display = 'none';
        });

        // ìƒˆ í´ë” ê²€ì¦ ë° ë¯¸ë¦¬ë³´ê¸° (ì •ë‹¹/í›„ë³´ìëª… êµ¬ì¡°)
        function validateNewFolder() {
            const partySelect = document.getElementById('partyFolderSelect').value;
            const customParty = document.getElementById('customPartyName').value.trim();
            const candidateName = document.getElementById('candidateFolderName').value.trim();

            // ì •ë‹¹ ê²°ì •
            let partyFolder = partySelect;
            if (partySelect === 'Other') {
                partyFolder = customParty;
            }

            if (!partyFolder) {
                alert('ì •ë‹¹ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!candidateName) {
                alert('í›„ë³´ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            // íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ (í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ í—ˆìš©)
            if (!/^[ê°€-í£a-zA-Z0-9\-_]+$/.test(partyFolder)) {
                alert('ì •ë‹¹ í´ë”ëª…ì—ëŠ” í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                return;
            }
            if (!/^[ê°€-í£a-zA-Z0-9\-_]+$/.test(candidateName)) {
                alert('í›„ë³´ìëª…ì—ëŠ” í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                return;
            }

            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            document.getElementById('previewPartyName').textContent = partyFolder;
            document.getElementById('previewCandidateName').textContent = candidateName;
            document.getElementById('newFolderPreview').style.display = 'block';

            // í´ë” ê²½ë¡œ ì„¤ì •: ì •ë‹¹/í›„ë³´ìëª…
            selectedSaveFolder = partyFolder + '/' + candidateName;
            createImagesFolder = true;  // images í´ë”ë„ ìƒì„±

            // í™•ì¸ í›„ PDF ì—…ë¡œë“œ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ë° ê°•ì¡°
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.style.border = '3px dashed #667eea';
            uploadArea.style.background = '#f0f4ff';
            uploadArea.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // 2ì´ˆ í›„ ì›ë˜ ìŠ¤íƒ€ì¼ë¡œ ë³µì›
            setTimeout(() => {
                uploadArea.style.border = '';
                uploadArea.style.background = '';
            }, 2000);
        }

        let createImagesFolder = false;  // images í´ë” ìƒì„± ì—¬ë¶€

        // ê¸°ì¡´ í´ë” ëª©ë¡ ë¡œë“œ
        async function loadExistingFolders() {
            try {
                const response = await fetch('/api/files/outputs');
                const data = await response.json();

                if (data.success && data.folders && data.folders.length > 0) {
                    const list = document.getElementById('existingFoldersList');
                    list.innerHTML = data.folders.map(folder => `
                        <span class="existing-folder-chip" data-folder="${folder.name}" onclick="selectExistingFolder('${folder.name}')">
                            ğŸ“ ${folder.name}
                            <small>(${folder.file_count}ê°œ)</small>
                        </span>
                    `).join('');
                } else {
                    document.getElementById('existingFolders').style.display = 'none';
                }
            } catch (e) {
                console.error('í´ë” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e);
                document.getElementById('existingFolders').style.display = 'none';
            }
        }

        // ê¸°ì¡´ í´ë” ì„ íƒ
        function selectExistingFolder(folderName) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.folder-option').forEach(o => o.classList.remove('selected'));

            // ì„ íƒ í‘œì‹œ
            event.target.closest('.existing-folder-chip').classList.add('selected');
            selectedSaveFolder = folderName;
            createImagesFolder = false;  // ê¸°ì¡´ í´ë”ëŠ” images í´ë” ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìŒ

            // ì»¤ìŠ¤í…€ ì…ë ¥ ë° ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€
            document.getElementById('customFolderInput').classList.remove('show');
            document.getElementById('newFolderPreview').style.display = 'none';
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        async function checkStatus() {
            try {
                const response = await fetch('/api/auto-convert/status');
                const data = await response.json();

                if (data.auto_converter_ready) {
                    document.getElementById('statusDot').className = 'status-dot ready';
                    document.getElementById('statusText').textContent = 'ì‹œìŠ¤í…œ ì¤€ë¹„ë¨';
                } else {
                    document.getElementById('statusDot').className = 'status-dot error';
                    document.getElementById('statusText').textContent = 'ì‹œìŠ¤í…œ ì˜¤ë¥˜';
                }

                document.getElementById('visionStatus').textContent =
                    `Vision OCR: ${data.vision_ocr_ready ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`;

                // ì •ë‹¹ ìƒ‰ìƒ í‘œì‹œ
                const partyColors = document.getElementById('partyColors');
                partyColors.innerHTML = data.supported_parties.map(party => `
                    <div class="party-chip" style="background: ${party.color}20; color: ${party.color};">
                        <span class="dot" style="background: ${party.color};"></span>
                        ${party.name}
                    </div>
                `).join('');
            } catch (e) {
                console.error('ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', e);
            }
        }

        checkStatus();
        loadExistingFolders();

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            handleFiles(fileInput.files);
        });

        function handleFiles(files) {
            const pdfFiles = Array.from(files).filter(f => f.name.toLowerCase().endsWith('.pdf'));

            if (pdfFiles.length === 0) {
                showError('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            if (!batchMode.checked && pdfFiles.length > 1) {
                showError('ë‹¨ì¼ íŒŒì¼ ëª¨ë“œì…ë‹ˆë‹¤. ë‹¤ì¤‘ íŒŒì¼ì€ ì¼ê´„ ë³€í™˜ ëª¨ë“œë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                return;
            }

            selectedFiles = pdfFiles;
            renderFileList();
            updateConvertButton();
        }

        function renderFileList() {
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                uploadArea.classList.remove('has-file');
                return;
            }

            uploadArea.classList.add('has-file');

            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-info">
                    <span class="icon">ğŸ“„</span>
                    <div class="details">
                        <div class="name">${file.name}</div>
                        <div class="size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove" onclick="removeFile(${index})">ì‚­ì œ</button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
            updateConvertButton();
        }

        function updateConvertButton() {
            if (selectedFiles.length > 0) {
                convertBtn.disabled = false;
                convertBtn.className = 'convert-btn ready';
                convertBtn.innerHTML = `<span>ğŸš€ ${selectedFiles.length}ê°œ íŒŒì¼ ìë™ ë³€í™˜ ì‹œì‘</span>`;
            } else {
                convertBtn.disabled = true;
                convertBtn.className = 'convert-btn disabled';
                convertBtn.innerHTML = '<span>ğŸ“„ PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>';
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function showError(message) {
            errorContainer.textContent = 'âŒ ' + message;
            errorContainer.classList.add('show');
            setTimeout(() => {
                errorContainer.classList.remove('show');
            }, 5000);
        }

        // ë³€í™˜ ì‹¤í–‰
        convertBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) return;

            errorContainer.classList.remove('show');
            resultContainer.classList.remove('show');

            convertBtn.disabled = true;
            convertBtn.className = 'convert-btn loading';
            convertBtn.innerHTML = '<span>ë³€í™˜ ì¤‘...</span>';

            progressContainer.classList.add('show');
            progressFill.style.width = '10%';
            progressText.textContent = 'PDF ë¶„ì„ ì¤‘...';

            try {
                let result;

                if (selectedFiles.length === 1) {
                    // ë‹¨ì¼ íŒŒì¼ ë³€í™˜
                    result = await convertSingle(selectedFiles[0]);
                } else {
                    // ì¼ê´„ ë³€í™˜
                    result = await convertBatch(selectedFiles);
                }

                progressFill.style.width = '100%';
                progressText.textContent = 'ì™„ë£Œ!';

                setTimeout(() => {
                    progressContainer.classList.remove('show');
                    showResult(result);
                }, 500);

            } catch (error) {
                progressContainer.classList.remove('show');
                showError(error.message);
                updateConvertButton();
            }
        });

        async function convertSingle(file) {
            const formData = new FormData();
            formData.append('file', file);

            // ì €ì¥ í´ë” ì¶”ê°€
            if (selectedSaveFolder) {
                formData.append('save_folder', selectedSaveFolder);
            }

            // images í´ë” ìƒì„± ì—¬ë¶€
            if (createImagesFolder) {
                formData.append('create_images_folder', 'true');
            }

            progressFill.style.width = '30%';
            progressText.textContent = 'ì •ë‹¹ ê°ì§€ ì¤‘...';

            await new Promise(r => setTimeout(r, 500));
            progressFill.style.width = '50%';
            progressText.textContent = 'ê³µì•½ ì¶”ì¶œ ì¤‘...';

            const response = await fetch('/api/auto-convert', {
                method: 'POST',
                body: formData
            });

            progressFill.style.width = '80%';
            progressText.textContent = 'HTML ìƒì„± ì¤‘...';

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'ë³€í™˜ ì‹¤íŒ¨');
            }

            return await response.json();
        }

        async function convertBatch(files) {
            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });

            progressFill.style.width = '30%';
            progressText.textContent = `${files.length}ê°œ íŒŒì¼ ì¼ê´„ ë³€í™˜ ì¤‘...`;

            const response = await fetch('/api/batch-convert', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'ì¼ê´„ ë³€í™˜ ì‹¤íŒ¨');
            }

            return await response.json();
        }

        function showResult(data) {
            resultContainer.classList.add('show');

            const resultInfo = document.getElementById('resultInfo');
            const previewBtn = document.getElementById('previewBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadFolderBtn = document.getElementById('downloadFolderBtn');

            if (data.result) {
                // ë‹¨ì¼ íŒŒì¼ ê²°ê³¼
                const result = data.result;
                resultInfo.innerHTML = `
                    <div class="result-item">
                        <div class="label">í›„ë³´ì</div>
                        <div class="value">${result.candidate?.name || 'ì¶”ì¶œë¨'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì •ë‹¹</div>
                        <div class="value">${result.candidate?.party || 'ê°ì§€ë¨'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ê³µì•½ ìˆ˜</div>
                        <div class="value">${result.statistics?.pledge_count || 0}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">í˜ì´ì§€</div>
                        <div class="value">${result.statistics?.page_count || 0}í˜ì´ì§€</div>
                    </div>
                `;

                previewBtn.href = result.url;
                downloadBtn.href = result.url;
                downloadBtn.download = result.filename;

                // í´ë” ZIP ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì„¤ì •
                if (selectedSaveFolder) {
                    downloadFolderBtn.href = `/api/download/folder/${encodeURIComponent(selectedSaveFolder)}`;
                    downloadFolderBtn.style.display = 'inline-block';
                } else {
                    downloadFolderBtn.style.display = 'none';
                }
            } else if (data.results) {
                // ì¼ê´„ ë³€í™˜ ê²°ê³¼
                const successCount = data.statistics.success;
                const failCount = data.statistics.failed;

                resultInfo.innerHTML = `
                    <div class="result-item">
                        <div class="label">ì´ íŒŒì¼</div>
                        <div class="value">${data.statistics.total}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì„±ê³µ</div>
                        <div class="value" style="color: #10B981;">${successCount}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì‹¤íŒ¨</div>
                        <div class="value" style="color: ${failCount > 0 ? '#EF4444' : 'inherit'};">${failCount}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ìƒíƒœ</div>
                        <div class="value">${successCount === data.statistics.total ? 'ëª¨ë‘ ì„±ê³µ' : 'ì¼ë¶€ ì‹¤íŒ¨'}</div>
                    </div>
                `;

                // ì²« ë²ˆì§¸ ì„±ê³µí•œ íŒŒì¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
                const firstSuccess = data.results.find(r => r.success);
                if (firstSuccess) {
                    previewBtn.href = firstSuccess.output_url;
                    previewBtn.textContent = 'ì²« ë²ˆì§¸ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°';
                } else {
                    previewBtn.style.display = 'none';
                }
                downloadBtn.style.display = 'none';
                downloadFolderBtn.style.display = 'none';
            }

            convertBtn.innerHTML = '<span>âœ… ë³€í™˜ ì™„ë£Œ</span>';
            convertBtn.className = 'convert-btn ready';
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            selectedFiles = [];
            renderFileList();
            updateConvertButton();
            resultContainer.classList.remove('show');
            fileInput.value = '';
        });
    </script>
</body>
</html>
