<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™„ì „ ìë™í™” ë¬¸ì„œ ë³€í™˜ê¸° - StudySnap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .auto-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10B981, #059669);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.5em;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: #fafafa;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.has-file {
            border-color: #10B981;
            background: #ecfdf5;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: #666;
            font-size: 0.95em;
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-info .icon {
            font-size: 2em;
        }

        .file-info .details {
            flex: 1;
            text-align: left;
        }

        .file-info .name {
            font-weight: 600;
            color: #333;
        }

        .file-info .size {
            color: #666;
            font-size: 0.9em;
        }

        .file-info .remove {
            background: #fee2e2;
            color: #dc2626;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        /* Convert Button */
        .convert-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .convert-btn.ready {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .convert-btn.ready:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .convert-btn.disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .convert-btn.loading {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        /* Progress */
        .progress-container {
            display: none;
            margin-top: 20px;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-weight: 500;
        }

        /* Result */
        .result-container {
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-success {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-success h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .result-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
        }

        .result-item .label {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .result-item .value {
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 3px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .result-actions a, .result-actions button {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-size: 1em;
        }

        .btn-preview {
            background: #667eea;
            color: white;
        }

        .btn-preview:hover {
            background: #5a67d8;
        }

        .btn-download {
            background: #10B981;
            color: white;
        }

        .btn-download:hover {
            background: #059669;
        }

        .btn-reset {
            background: #6b7280;
            color: white;
        }

        .btn-reset:hover {
            background: #4b5563;
        }

        /* Features List */
        .features-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .feature-item .icon {
            font-size: 1.5em;
        }

        .feature-item .text {
            font-weight: 500;
            color: #333;
        }

        /* Party Colors */
        .party-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .party-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9em;
        }

        .party-chip .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Status */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: #f0f9ff;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        .status-dot.ready {
            background: #10B981;
        }

        .status-dot.error {
            background: #EF4444;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Error */
        .error-container {
            display: none;
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .error-container.show {
            display: block;
        }

        /* Batch Mode */
        .batch-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .batch-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        /* ì €ì¥ ê²½ë¡œ ì„ íƒ */
        .save-path-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .save-path-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .folder-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .folder-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .folder-option.selected {
            border-color: #667eea;
            background: #e8efff;
        }

        .folder-option input[type="radio"] {
            display: none;
        }

        .folder-option .folder-icon {
            font-size: 1.5em;
        }

        .folder-option .folder-info {
            flex: 1;
        }

        .folder-option .folder-name {
            font-weight: 600;
            color: #333;
        }

        .folder-option .folder-desc {
            font-size: 0.8em;
            color: #666;
        }

        .custom-folder-input {
            display: none;
            margin-top: 15px;
        }

        .custom-folder-input.show {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .custom-folder-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
        }

        .custom-folder-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .existing-folders {
            margin-top: 15px;
        }

        .existing-folders-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .existing-folders-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .existing-folder-chip {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .existing-folder-chip:hover {
            background: #e8efff;
            border-color: #667eea;
        }

        .existing-folder-chip.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* ==================== ëª¨ë“œ ì„ íƒ íƒ­ ==================== */
        .mode-tabs {
            display: flex;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
            gap: 5px;
        }

        .mode-tab {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: transparent;
            color: rgba(255,255,255,0.8);
        }

        .mode-tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .mode-tab.active {
            background: white;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .mode-tab.active.election { color: #667eea; }
        .mode-tab.active.church { color: #8B4513; }

        .mode-badge {
            font-size: 0.7em;
            padding: 3px 8px;
            border-radius: 10px;
            background: currentColor;
            color: white;
        }

        .mode-tab.active .mode-badge {
            background: currentColor;
        }

        /* ëª¨ë“œë³„ í…Œë§ˆ */
        body.church-mode {
            background: linear-gradient(135deg, #8B4513 0%, #5D3A1A 100%);
        }

        body.church-mode .convert-btn.ready {
            background: linear-gradient(135deg, #8B4513 0%, #5D3A1A 100%);
        }

        body.church-mode .status-bar {
            background: #FDF8F0;
        }

        body.church-mode .progress-fill {
            background: linear-gradient(90deg, #8B4513, #C5A572);
        }

        body.church-mode .result-success {
            background: linear-gradient(135deg, #8B4513, #A0522D);
        }

        /* êµíšŒ ì „ìš© UI */
        .church-options {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #FDF8F0;
            border-radius: 12px;
            border: 1px solid #E8DCC8;
        }

        .church-options.show { display: block; }

        .church-options-title {
            font-weight: 600;
            color: #8B4513;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .church-preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .church-preset {
            padding: 12px 15px;
            background: white;
            border: 2px solid #E8DCC8;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .church-preset:hover {
            border-color: #C5A572;
            background: #FFFEF9;
        }

        .church-preset.selected {
            border-color: #8B4513;
            background: #FDF8F0;
        }

        .church-preset-name {
            font-weight: 600;
            color: #5D3A1A;
            margin-bottom: 4px;
        }

        .church-preset-style {
            font-size: 0.75em;
            color: #8D6E63;
        }

        .theme-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .theme-option {
            padding: 10px;
            border: 2px solid #E8DCC8;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            background: white;
        }

        .theme-option:hover { border-color: #C5A572; }
        .theme-option.selected { border-color: #8B4513; background: #FDF8F0; }

        .theme-option-icon { font-size: 1.5em; margin-bottom: 4px; }
        .theme-option-name { font-size: 0.8em; font-weight: 500; color: #5D3A1A; }

        .church-folder-input {
            margin-top: 15px;
        }

        .church-folder-input label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            color: #5D3A1A;
            margin-bottom: 6px;
        }

        .church-folder-input input,
        .church-folder-input select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #E8DCC8;
            border-radius: 8px;
            font-size: 0.95em;
            background: white;
        }

        .church-folder-input input:focus,
        .church-folder-input select:focus {
            outline: none;
            border-color: #C5A572;
        }

        .church-folder-preview {
            margin-top: 12px;
            padding: 12px;
            background: #E8F5E9;
            border-radius: 8px;
            font-size: 0.85em;
        }

        .church-folder-preview .path {
            font-family: monospace;
            color: #2E7D32;
            margin-top: 4px;
        }

        /* êµíšŒ ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸ */
        .church-features-list {
            display: none;
        }

        body.church-mode .election-features-list { display: none; }
        body.church-mode .church-features-list { display: grid; }
    </style>
</head>
<body>
    <!-- ì¹´í…Œê³ ë¦¬ë³„ ë³€í™˜ê¸° ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav style="max-width: 900px; margin: 0 auto 10px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
        <a href="/static/auto-converter.html" style="padding: 8px 16px; background: white; color: #667eea; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 0.9em; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">All</a>
        <a href="/static/election-converter.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #667eea; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Election</a>
        <a href="/static/church-converter.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #8B4513; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Church</a>
        <a href="/static/lecture-converter.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #2563eb; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Lecture</a>
        <a href="/static/newsletter-converter.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #059669; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Newsletter</a>
        <a href="/static/catalog-converter.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #dc2626; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Catalog</a>
        <a href="/static/explorer.html" style="padding: 8px 16px; background: rgba(255,255,255,0.95); color: #1e3c72; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.9em;">Explorer</a>
    </nav>

    <div class="container">
        <header class="header">
            <h1>
                <span class="auto-badge">AUTO</span>
                <span id="headerTitle">PDF ì—…ë¡œë“œë§Œ í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë°”ì¼ ìµœì í™” í˜ì´ì§€ ìƒì„±</span>
            </h1>
        </header>

        <!-- ì–¸ì–´ ì„ íƒ -->
        <div style="text-align: right; margin-bottom: 10px;">
            <select id="languageSelect" onchange="changeLanguage(this.value)" style="padding: 6px 12px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.9); font-size: 0.85em; cursor: pointer;">
                <option value="ko" selected>ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
                <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            </select>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ íƒ­ -->
        <div class="mode-tabs" style="flex-wrap: wrap;">
            <button class="mode-tab active election" data-mode="election" onclick="switchMode('election')">
                ğŸ—³ï¸ <span data-i18n="election">ì„ ê±° ê³µë³´ë¬¼</span>
            </button>
            <button class="mode-tab church" data-mode="church" onclick="switchMode('church')">
                â›ª <span data-i18n="church">êµíšŒ ì£¼ë³´</span>
            </button>
            <button class="mode-tab lecture" data-mode="lecture" onclick="switchMode('lecture')" style="color: rgba(255,255,255,0.8);">
                ğŸ“š <span data-i18n="lecture">ê°•ì˜ êµì¬</span>
            </button>
            <button class="mode-tab newsletter" data-mode="newsletter" onclick="switchMode('newsletter')" style="color: rgba(255,255,255,0.8);">
                ğŸ“° <span data-i18n="newsletter">ì†Œì‹ì§€</span>
            </button>
            <button class="mode-tab catalog" data-mode="catalog" onclick="switchMode('catalog')" style="color: rgba(255,255,255,0.8);">
                ğŸ“¦ <span data-i18n="catalog">ì¹´íƒˆë¡œê·¸</span>
            </button>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <span class="status-dot ready" id="statusDot"></span>
                <span id="statusText">ì‹œìŠ¤í…œ ì¤€ë¹„ë¨</span>
            </div>
            <span id="visionStatus">Vision OCR: í™•ì¸ ì¤‘...</span>
        </div>

        <!-- Upload Card -->
        <div class="card">
            <h2 class="card-title">ğŸ“¤ PDF ì—…ë¡œë“œ</h2>

            <div class="batch-toggle">
                <input type="checkbox" id="batchMode">
                <label for="batchMode">ë‹¤ì¤‘ íŒŒì¼ ì¼ê´„ ë³€í™˜ ëª¨ë“œ</label>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon" id="uploadIcon">ğŸ“„</div>
                <h3 id="uploadTitle">ì„ ê±°ê³µë³´ë¬¼ PDFë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</h3>
                <p>ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                <input type="file" id="fileInput" class="file-input" accept=".pdf" multiple>
            </div>

            <div id="fileList"></div>

            <!-- ì €ì¥ ê²½ë¡œ ì„ íƒ -->
            <div class="save-path-section">
                <div class="save-path-title">ğŸ“ ì €ì¥ ê²½ë¡œ ì„ íƒ</div>
                <div class="folder-select-grid">
                    <label class="folder-option selected" data-folder="">
                        <input type="radio" name="saveFolder" value="" checked>
                        <span class="folder-icon">ğŸ“„</span>
                        <div class="folder-info">
                            <div class="folder-name">ê¸°ë³¸ (outputs)</div>
                            <div class="folder-desc">outputs í´ë”ì— ì €ì¥</div>
                        </div>
                    </label>
                    <label class="folder-option" data-folder="custom">
                        <input type="radio" name="saveFolder" value="custom">
                        <span class="folder-icon">â•</span>
                        <div class="folder-info">
                            <div class="folder-name">ìƒˆ í´ë” ìƒì„±</div>
                            <div class="folder-desc">ìƒˆ í´ë” + images í´ë”</div>
                        </div>
                    </label>
                </div>

                <!-- ìƒˆ í´ë” ì…ë ¥ (ì •ë‹¹/í›„ë³´ìëª… êµ¬ì¡°) -->
                <div class="custom-folder-input" id="customFolderInput">
                    <div style="display: flex; align-items: center; gap: 5px; flex-wrap: wrap;">
                        <span>outputs/</span>
                        <select id="partyFolderSelect" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="">ì •ë‹¹ ì„ íƒ</option>
                            <option value="Minjoo">ë¯¼ì£¼ë‹¹ (Minjoo)</option>
                            <option value="PPP">êµ­ë¯¼ì˜í˜ (PPP)</option>
                            <option value="Other">ê¸°íƒ€</option>
                        </select>
                        <span>/</span>
                        <input type="text" id="candidateFolderName" placeholder="í›„ë³´ìëª… (ì˜ˆ: ì´ê´‘ì¬)" style="flex: 1; min-width: 100px;">
                    </div>
                    <div id="customPartyInput" style="display: none; margin-top: 10px;">
                        <input type="text" id="customPartyName" placeholder="ì •ë‹¹ í´ë”ëª… ì§ì ‘ ì…ë ¥" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <button type="button" onclick="validateNewFolder()" style="margin-top: 10px; padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; width: 100%;">í™•ì¸</button>
                </div>
                <div id="newFolderPreview" style="display: none; margin-top: 10px; padding: 12px 15px; background: #e8f5e9; border-radius: 8px; font-size: 0.9em;">
                    <div style="color: #2e7d32; font-weight: 500;">âœ… ìƒì„±ë  í´ë” êµ¬ì¡°:</div>
                    <div style="margin-top: 5px; font-family: monospace; color: #333;">
                        ğŸ“ outputs/<span id="previewPartyName">ì •ë‹¹</span>/<span id="previewCandidateName">í›„ë³´ìëª…</span>/<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ ğŸ“„ [í›„ë³´ìëª…].html<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;â””â”€ ğŸ“ images/ (ì´ë¯¸ì§€ ì—…ë¡œë“œìš©)
                    </div>
                </div>

                <!-- ê¸°ì¡´ í´ë” ëª©ë¡ (ì„ ê±°ìš©) -->
                <div class="existing-folders" id="existingFolders">
                    <div class="existing-folders-title">ğŸ“‚ ê¸°ì¡´ í´ë” ì„ íƒ:</div>
                    <div class="existing-folders-list" id="existingFoldersList">
                        <span style="color: #999; font-size: 0.9em;">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
            </div>

            <!-- ==================== êµíšŒ ì£¼ë³´ ì „ìš© ì˜µì…˜ ==================== -->
            <div class="church-options" id="churchOptions">
                <div class="church-options-title">â›ª êµíšŒ ì£¼ë³´ ì„¤ì •</div>

                <!-- êµíšŒ ì„ íƒ/ì…ë ¥ -->
                <div class="church-folder-input">
                    <label>ğŸ“ êµíšŒëª…</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="churchSelect" onchange="onChurchSelect()" style="flex: 1;">
                            <option value="">-- êµíšŒ ì„ íƒ ë˜ëŠ” ìƒˆë¡œ ì…ë ¥ --</option>
                            <option value="new">â• ìƒˆ êµíšŒ ì¶”ê°€</option>
                        </select>
                    </div>
                    <input type="text" id="newChurchName" placeholder="ìƒˆ êµíšŒëª… ì…ë ¥ (ì˜ˆ: ëª…ì„±êµíšŒ)" style="display: none; margin-top: 10px;">
                </div>

                <!-- ê¸°ì¡´ êµíšŒ ëª©ë¡ -->
                <div id="existingChurches" style="margin-top: 15px;">
                    <div style="font-size: 0.85em; color: #8D6E63; margin-bottom: 8px;">ğŸ“‚ ê¸°ì¡´ êµíšŒ:</div>
                    <div id="existingChurchList" class="church-preset-grid">
                        <span style="color: #999; font-size: 0.85em;">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>

                <!-- ì£¼ë³´ ë‚ ì§œ -->
                <div class="church-folder-input">
                    <label>ğŸ“… ì£¼ë³´ ë‚ ì§œ</label>
                    <input type="date" id="bulletinDate" onchange="updateChurchPreview()">
                </div>

                <!-- ì ˆê¸° í…Œë§ˆ ì„ íƒ -->
                <div style="margin-top: 20px;">
                    <div style="font-size: 0.85em; font-weight: 600; color: #5D3A1A; margin-bottom: 10px;">
                        ğŸ„ ì ˆê¸° í…Œë§ˆ (ì„ íƒ)
                    </div>
                    <div class="theme-select-grid" id="churchThemeGrid">
                        <div class="theme-option selected" data-theme="default" onclick="selectChurchTheme('default')">
                            <div class="theme-option-icon">ğŸ“–</div>
                            <div class="theme-option-name">ì¼ë°˜</div>
                        </div>
                        <div class="theme-option" data-theme="advent" onclick="selectChurchTheme('advent')">
                            <div class="theme-option-icon">ğŸ•¯ï¸</div>
                            <div class="theme-option-name">ëŒ€ë¦¼ì ˆ</div>
                        </div>
                        <div class="theme-option" data-theme="christmas" onclick="selectChurchTheme('christmas')">
                            <div class="theme-option-icon">ğŸ„</div>
                            <div class="theme-option-name">ì„±íƒ„ì ˆ</div>
                        </div>
                        <div class="theme-option" data-theme="lent" onclick="selectChurchTheme('lent')">
                            <div class="theme-option-icon">âœï¸</div>
                            <div class="theme-option-name">ì‚¬ìˆœì ˆ</div>
                        </div>
                        <div class="theme-option" data-theme="easter" onclick="selectChurchTheme('easter')">
                            <div class="theme-option-icon">ğŸŒ¸</div>
                            <div class="theme-option-name">ë¶€í™œì ˆ</div>
                        </div>
                        <div class="theme-option" data-theme="pentecost" onclick="selectChurchTheme('pentecost')">
                            <div class="theme-option-icon">ğŸ”¥</div>
                            <div class="theme-option-name">ì„±ë ¹ê°•ë¦¼</div>
                        </div>
                        <div class="theme-option" data-theme="harvest" onclick="selectChurchTheme('harvest')">
                            <div class="theme-option-icon">ğŸŒ¾</div>
                            <div class="theme-option-name">ì¶”ìˆ˜ê°ì‚¬</div>
                        </div>
                    </div>
                </div>

                <!-- ì €ì¥ ê²½ë¡œ ë¯¸ë¦¬ë³´ê¸° -->
                <div class="church-folder-preview" id="churchFolderPreview" style="display: none;">
                    <div style="color: #2E7D32; font-weight: 500;">âœ… ì €ì¥ ê²½ë¡œ:</div>
                    <div class="path" id="churchPathPreview">outputs/Church/êµíšŒëª…/YYYY-MM-DD.html</div>
                </div>
            </div>

            <button class="convert-btn disabled" id="convertBtn" disabled>
                <span>ğŸ“„ PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </button>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
            </div>

            <div class="error-container" id="errorContainer"></div>
        </div>

        <!-- Result Card -->
        <div class="card result-container" id="resultContainer">
            <div class="result-success">
                <h3>ë³€í™˜ ì™„ë£Œ!</h3>
                <div class="result-info" id="resultInfo"></div>
            </div>
            <div class="result-actions">
                <a href="#" class="btn-preview" id="previewBtn" target="_blank">ë¯¸ë¦¬ë³´ê¸°</a>
                <a href="#" class="btn-download" id="downloadBtn" download>HTML ë‹¤ìš´ë¡œë“œ</a>
                <a href="#" class="btn-download" id="downloadFolderBtn" style="background: #28a745; display: none;">í´ë” ZIP ë‹¤ìš´ë¡œë“œ</a>
                <button class="btn-reset" id="resetBtn">ìƒˆë¡œ ë³€í™˜</button>
            </div>
        </div>

        <!-- Features Card -->
        <div class="card">
            <h2 class="card-title" id="featuresTitle">ğŸ—³ï¸ ìë™í™” ê¸°ëŠ¥</h2>

            <!-- ì„ ê±° ê³µë³´ë¬¼ ê¸°ëŠ¥ -->
            <div class="features-list election-features-list">
                <div class="feature-item">
                    <span class="icon">ğŸ¨</span>
                    <span class="text">ì •ë‹¹ë³„ í…Œë§ˆ ìë™ ì ìš©</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ‘¤</span>
                    <span class="text">í›„ë³´ì ì •ë³´ ìë™ ì¶”ì¶œ</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“‹</span>
                    <span class="text">ê³µì•½ ìë™ êµ¬ì¡°í™”</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“±</span>
                    <span class="text">ëª¨ë°”ì¼ ìµœì í™”</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ”—</span>
                    <span class="text">SNS ë§í¬ ìë™ ì—°ê²°</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“</span>
                    <span class="text">ì „í™”ë²ˆí˜¸ í´ë¦­ í†µí™”</span>
                </div>
            </div>

            <!-- êµíšŒ ì£¼ë³´ ê¸°ëŠ¥ -->
            <div class="features-list church-features-list">
                <div class="feature-item">
                    <span class="icon">ğŸ“–</span>
                    <span class="text">ì˜ˆë°° ìˆœì„œ ìë™ ì¶”ì¶œ</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸµ</span>
                    <span class="text">ì°¬ì†¡ê°€ ìœ íŠœë¸Œ ì—°ê²°</span>
                </div>
                <div class="feature-item">
                    <span class="icon">âœï¸</span>
                    <span class="text">ì„±ê²½ êµ¬ì ˆ ìë™ ë§í¬</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“±</span>
                    <span class="text">ëª¨ë°”ì¼ ìµœì í™” ë””ìì¸</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ„</span>
                    <span class="text">ì ˆê¸°ë³„ í…Œë§ˆ ìë™ ì ìš©</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸŒ™</span>
                    <span class="text">ë‹¤í¬ëª¨ë“œ ì§€ì›</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ“¢</span>
                    <span class="text">êµíšŒ ì†Œì‹ ìë™ êµ¬ì¡°í™”</span>
                </div>
                <div class="feature-item">
                    <span class="icon">ğŸ”—</span>
                    <span class="text">ê³µìœ í•˜ê¸° ê¸°ëŠ¥ ë‚´ì¥</span>
                </div>
            </div>

            <!-- ì„ ê±° - ì§€ì› ì •ë‹¹ -->
            <div id="partySection">
                <h3 style="margin-top: 25px; margin-bottom: 10px; color: #666;">ì§€ì› ì •ë‹¹</h3>
                <div class="party-colors" id="partyColors"></div>
            </div>

            <!-- êµíšŒ - ì§€ì› êµë‹¨/ìŠ¤íƒ€ì¼ -->
            <div id="churchStyleSection" style="display: none;">
                <h3 style="margin-top: 25px; margin-bottom: 10px; color: #666;">ì§€ì› ìŠ¤íƒ€ì¼</h3>
                <div class="party-colors">
                    <div class="party-chip" style="background: #5B4B9E20; color: #5B4B9E;">
                        <span class="dot" style="background: #5B4B9E;"></span>
                        ëª¨ë˜ ìŠ¤íƒ€ì¼
                    </div>
                    <div class="party-chip" style="background: #8B451320; color: #8B4513;">
                        <span class="dot" style="background: #8B4513;"></span>
                        ì „í†µ ìŠ¤íƒ€ì¼
                    </div>
                    <div class="party-chip" style="background: #1E3A5F20; color: #1E3A5F;">
                        <span class="dot" style="background: #1E3A5F;"></span>
                        ëŒ€í˜•êµíšŒ
                    </div>
                    <div class="party-chip" style="background: #C5A57220; color: #8B6914;">
                        <span class="dot" style="background: #C5A572;"></span>
                        ì†Œí˜•êµíšŒ
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const convertBtn = document.getElementById('convertBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const resultContainer = document.getElementById('resultContainer');
        const errorContainer = document.getElementById('errorContainer');
        const batchMode = document.getElementById('batchMode');

        let selectedFiles = [];
        let selectedSaveFolder = '';  // ì €ì¥í•  í•˜ìœ„ í´ë”

        // ==================== ë‹¤êµ­ì–´ ì§€ì› ====================
        const translations = {
            ko: {
                election: 'ì„ ê±° ê³µë³´ë¬¼', church: 'êµíšŒ ì£¼ë³´', lecture: 'ê°•ì˜ êµì¬',
                newsletter: 'ì†Œì‹ì§€', catalog: 'ì¹´íƒˆë¡œê·¸',
                headerElection: 'PDF ì—…ë¡œë“œë§Œ í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë°”ì¼ ìµœì í™” í˜ì´ì§€ ìƒì„±',
                headerChurch: 'PDF ì—…ë¡œë“œë§Œ í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë°”ì¼ ìµœì í™” í˜ì´ì§€ ìƒì„±',
                uploadElection: 'ì„ ê±°ê³µë³´ë¬¼ PDFë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”',
                uploadChurch: 'êµíšŒ ì£¼ë³´ PDFë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”',
                systemReady: 'ì‹œìŠ¤í…œ ì¤€ë¹„ë¨', converting: 'ë³€í™˜ ì¤‘...',
                complete: 'ë³€í™˜ ì™„ë£Œ!', selectPdf: 'PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”',
                featuresElection: 'ğŸ—³ï¸ ìë™í™” ê¸°ëŠ¥', featuresChurch: 'â›ª ì£¼ë³´ ë³€í™˜ ê¸°ëŠ¥'
            },
            en: {
                election: 'Election', church: 'Church Bulletin', lecture: 'Lecture',
                newsletter: 'Newsletter', catalog: 'Catalog',
                headerElection: 'Upload PDF to auto-generate mobile-optimized pages',
                headerChurch: 'Upload PDF to auto-generate mobile-optimized pages',
                uploadElection: 'Drag election PDF here',
                uploadChurch: 'Drag church bulletin PDF here',
                systemReady: 'System Ready', converting: 'Converting...',
                complete: 'Complete!', selectPdf: 'Please select PDF',
                featuresElection: 'ğŸ—³ï¸ Features', featuresChurch: 'â›ª Bulletin Features'
            },
            zh: {
                election: 'é€‰ä¸¾å…¬æŠ¥', church: 'æ•™ä¼šå‘¨æŠ¥', lecture: 'è®²ä¹‰æ•™æ',
                newsletter: 'é€šè®¯', catalog: 'ç›®å½•',
                headerElection: 'ä¸Šä¼ PDFè‡ªåŠ¨ç”Ÿæˆç§»åŠ¨ä¼˜åŒ–é¡µé¢',
                headerChurch: 'ä¸Šä¼ PDFè‡ªåŠ¨ç”Ÿæˆç§»åŠ¨ä¼˜åŒ–é¡µé¢',
                uploadElection: 'å°†é€‰ä¸¾PDFæ‹–åˆ°è¿™é‡Œ',
                uploadChurch: 'å°†æ•™ä¼šå‘¨æŠ¥PDFæ‹–åˆ°è¿™é‡Œ',
                systemReady: 'ç³»ç»Ÿå°±ç»ª', converting: 'è½¬æ¢ä¸­...',
                complete: 'å®Œæˆ!', selectPdf: 'è¯·é€‰æ‹©PDF',
                featuresElection: 'ğŸ—³ï¸ åŠŸèƒ½', featuresChurch: 'â›ª å‘¨æŠ¥åŠŸèƒ½'
            },
            ja: {
                election: 'é¸æŒ™å…¬å ±', church: 'æ•™ä¼šé€±å ±', lecture: 'è¬›ç¾©è³‡æ–™',
                newsletter: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼', catalog: 'ã‚«ã‚¿ãƒ­ã‚°',
                headerElection: 'PDFã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆ',
                headerChurch: 'PDFã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆ',
                uploadElection: 'é¸æŒ™PDFã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°',
                uploadChurch: 'æ•™ä¼šé€±å ±PDFã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°',
                systemReady: 'ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', converting: 'å¤‰æ›ä¸­...',
                complete: 'å®Œäº†!', selectPdf: 'PDFã‚’é¸æŠã—ã¦ãã ã•ã„',
                featuresElection: 'ğŸ—³ï¸ æ©Ÿèƒ½', featuresChurch: 'â›ª é€±å ±æ©Ÿèƒ½'
            },
            id: {
                election: 'Brosur Pemilu', church: 'Buletin Gereja', lecture: 'Materi Kuliah',
                newsletter: 'Buletin', catalog: 'Katalog',
                headerElection: 'Unggah PDF untuk membuat halaman mobile-optimized',
                headerChurch: 'Unggah PDF untuk membuat halaman mobile-optimized',
                uploadElection: 'Seret PDF pemilu ke sini',
                uploadChurch: 'Seret PDF buletin gereja ke sini',
                systemReady: 'Sistem Siap', converting: 'Mengonversi...',
                complete: 'Selesai!', selectPdf: 'Pilih PDF',
                featuresElection: 'ğŸ—³ï¸ Fitur', featuresChurch: 'â›ª Fitur Buletin'
            },
            es: {
                election: 'Folleto Electoral', church: 'BoletÃ­n de Iglesia', lecture: 'Material de Clase',
                newsletter: 'BoletÃ­n', catalog: 'CatÃ¡logo',
                headerElection: 'Sube PDF para generar pÃ¡ginas optimizadas para mÃ³viles',
                headerChurch: 'Sube PDF para generar pÃ¡ginas optimizadas para mÃ³viles',
                uploadElection: 'Arrastra el PDF electoral aquÃ­',
                uploadChurch: 'Arrastra el PDF del boletÃ­n aquÃ­',
                systemReady: 'Sistema Listo', converting: 'Convirtiendo...',
                complete: 'Â¡Completado!', selectPdf: 'Selecciona PDF',
                featuresElection: 'ğŸ—³ï¸ Funciones', featuresChurch: 'â›ª Funciones del BoletÃ­n'
            },
            ru: {
                election: 'Ğ˜Ğ·Ğ±Ğ¸Ñ€Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ±Ñ€Ğ¾ÑˆÑÑ€Ğ°', church: 'Ğ¦ĞµÑ€ĞºĞ¾Ğ²Ğ½Ñ‹Ğ¹ Ğ±ÑĞ»Ğ»ĞµÑ‚ĞµĞ½ÑŒ', lecture: 'Ğ£Ñ‡ĞµĞ±Ğ½Ñ‹Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹',
                newsletter: 'Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ±ÑĞ»Ğ»ĞµÑ‚ĞµĞ½ÑŒ', catalog: 'ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³',
                headerElection: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ PDF Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†',
                headerChurch: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ PDF Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†',
                uploadElection: 'ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ PDF ÑÑĞ´Ğ°',
                uploadChurch: 'ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ PDF Ğ±ÑĞ»Ğ»ĞµÑ‚ĞµĞ½Ñ ÑÑĞ´Ğ°',
                systemReady: 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°', converting: 'ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ...',
                complete: 'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!', selectPdf: 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ PDF',
                featuresElection: 'ğŸ—³ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸', featuresChurch: 'â›ª Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ±ÑĞ»Ğ»ĞµÑ‚ĞµĞ½Ñ'
            },
            fr: {
                election: 'Brochure Ã‰lectorale', church: 'Bulletin d\'Ã‰glise', lecture: 'MatÃ©riel de Cours',
                newsletter: 'Bulletin', catalog: 'Catalogue',
                headerElection: 'TÃ©lÃ©chargez un PDF pour gÃ©nÃ©rer des pages optimisÃ©es mobile',
                headerChurch: 'TÃ©lÃ©chargez un PDF pour gÃ©nÃ©rer des pages optimisÃ©es mobile',
                uploadElection: 'Glissez le PDF Ã©lectoral ici',
                uploadChurch: 'Glissez le PDF du bulletin ici',
                systemReady: 'SystÃ¨me PrÃªt', converting: 'Conversion...',
                complete: 'TerminÃ©!', selectPdf: 'SÃ©lectionnez PDF',
                featuresElection: 'ğŸ—³ï¸ FonctionnalitÃ©s', featuresChurch: 'â›ª FonctionnalitÃ©s du Bulletin'
            }
        };

        let currentLanguage = 'ko';

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            applyTranslations();
        }

        function applyTranslations() {
            const t = translations[currentLanguage];
            // ëª¨ë“œ ë²„íŠ¼ í…ìŠ¤íŠ¸
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (t[key]) el.textContent = t[key];
            });
            // í—¤ë”
            const headerKey = currentMode === 'church' ? 'headerChurch' : 'headerElection';
            document.getElementById('headerTitle').textContent = t[headerKey];
            // ì—…ë¡œë“œ íƒ€ì´í‹€
            const uploadKey = currentMode === 'church' ? 'uploadChurch' : 'uploadElection';
            document.getElementById('uploadTitle').textContent = t[uploadKey];
            // ìƒíƒœ
            document.getElementById('statusText').textContent = t.systemReady;
            // ê¸°ëŠ¥ íƒ€ì´í‹€
            const featKey = currentMode === 'church' ? 'featuresChurch' : 'featuresElection';
            document.getElementById('featuresTitle').textContent = t[featKey];
        }

        // ì €ì¥ëœ ì–¸ì–´ ë¶ˆëŸ¬ì˜¤ê¸°
        const savedLang = localStorage.getItem('preferredLanguage');
        if (savedLang) {
            currentLanguage = savedLang;
            document.getElementById('languageSelect').value = savedLang;
            applyTranslations();
        }

        // ==================== ëª¨ë“œ ê´€ë¦¬ ====================
        let currentMode = 'election';  // 'election' ë˜ëŠ” 'church'
        let selectedChurch = '';
        let selectedChurchTheme = 'default';
        let bulletinDate = '';

        function switchMode(mode) {
            // ì „ìš© í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            if (mode === 'lecture') {
                window.location.href = '/static/lecture-converter.html';
                return;
            }
            if (mode === 'newsletter') {
                window.location.href = '/static/newsletter-converter.html';
                return;
            }
            if (mode === 'catalog') {
                window.location.href = '/static/catalog-converter.html';
                return;
            }

            currentMode = mode;

            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.mode === mode) {
                    tab.classList.add('active');
                }
            });

            // Body í´ë˜ìŠ¤ ì „í™˜
            document.body.classList.toggle('church-mode', mode === 'church');

            // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const t = translations[currentLanguage];
            if (mode === 'church') {
                document.getElementById('headerTitle').textContent = t.headerChurch;
                document.getElementById('uploadIcon').textContent = 'â›ª';
                document.getElementById('uploadTitle').textContent = t.uploadChurch;
                document.getElementById('featuresTitle').textContent = t.featuresChurch;
            } else {
                document.getElementById('headerTitle').textContent = t.headerElection;
                document.getElementById('uploadIcon').textContent = 'ğŸ“„';
                document.getElementById('uploadTitle').textContent = t.uploadElection;
                document.getElementById('featuresTitle').textContent = t.featuresElection;
            }

            // ì„ ê±°/êµíšŒ ì „ìš© UI í† ê¸€
            document.querySelector('.save-path-section').style.display = mode === 'election' ? 'block' : 'none';
            document.getElementById('churchOptions').classList.toggle('show', mode === 'church');
            document.getElementById('partySection').style.display = mode === 'election' ? 'block' : 'none';
            document.getElementById('churchStyleSection').style.display = mode === 'church' ? 'block' : 'none';

            // íŒŒì¼ ì´ˆê¸°í™”
            selectedFiles = [];
            renderFileList();
            updateConvertButton();

            // êµíšŒ ëª¨ë“œì¼ ë•Œ êµíšŒ ëª©ë¡ ë¡œë“œ
            if (mode === 'church') {
                loadExistingChurches();
                // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('bulletinDate').value = today;
                bulletinDate = today;
            }
        }

        // ==================== êµíšŒ ê´€ë ¨ í•¨ìˆ˜ ====================
        async function loadExistingChurches() {
            try {
                const response = await fetch('/api/files/outputs/Church');
                const data = await response.json();

                const churchList = document.getElementById('existingChurchList');
                const churchSelect = document.getElementById('churchSelect');

                if (data.success && data.folders && data.folders.length > 0) {
                    // êµíšŒ ëª©ë¡ ê·¸ë¦¬ë“œ
                    churchList.innerHTML = data.folders.map(folder => `
                        <div class="church-preset" data-church="${folder.name}" onclick="selectChurchPreset('${folder.name}')">
                            <div class="church-preset-name">â›ª ${folder.name}</div>
                            <div class="church-preset-style">${folder.file_count}ê°œ ì£¼ë³´</div>
                        </div>
                    `).join('');

                    // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì˜µì…˜ ì¶”ê°€
                    churchSelect.innerHTML = `
                        <option value="">-- êµíšŒ ì„ íƒ ë˜ëŠ” ìƒˆë¡œ ì…ë ¥ --</option>
                        ${data.folders.map(f => `<option value="${f.name}">${f.name}</option>`).join('')}
                        <option value="new">â• ìƒˆ êµíšŒ ì¶”ê°€</option>
                    `;
                } else {
                    churchList.innerHTML = '<span style="color: #999; font-size: 0.85em;">ì•„ì§ ë“±ë¡ëœ êµíšŒê°€ ì—†ìŠµë‹ˆë‹¤</span>';
                }
            } catch (e) {
                console.error('êµíšŒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e);
                document.getElementById('existingChurchList').innerHTML = '<span style="color: #999;">ë¡œë“œ ì‹¤íŒ¨</span>';
            }
        }

        function onChurchSelect() {
            const value = document.getElementById('churchSelect').value;
            const newChurchInput = document.getElementById('newChurchName');

            if (value === 'new') {
                newChurchInput.style.display = 'block';
                newChurchInput.focus();
                selectedChurch = '';
            } else {
                newChurchInput.style.display = 'none';
                selectedChurch = value;
            }

            // í”„ë¦¬ì…‹ ì„ íƒ í•´ì œ
            document.querySelectorAll('.church-preset').forEach(p => p.classList.remove('selected'));

            updateChurchPreview();
        }

        function selectChurchPreset(churchName) {
            selectedChurch = churchName;
            document.getElementById('churchSelect').value = churchName;
            document.getElementById('newChurchName').style.display = 'none';

            // UI ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.church-preset').forEach(p => {
                p.classList.toggle('selected', p.dataset.church === churchName);
            });

            updateChurchPreview();
        }

        function selectChurchTheme(theme) {
            selectedChurchTheme = theme;
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.theme === theme);
            });
        }

        function updateChurchPreview() {
            const newChurchInput = document.getElementById('newChurchName');
            const churchName = document.getElementById('churchSelect').value === 'new'
                ? newChurchInput.value.trim()
                : selectedChurch;

            const dateValue = document.getElementById('bulletinDate').value;
            bulletinDate = dateValue;

            const preview = document.getElementById('churchFolderPreview');
            const pathPreview = document.getElementById('churchPathPreview');

            if (churchName && dateValue) {
                preview.style.display = 'block';
                pathPreview.textContent = `outputs/Church/${churchName}/${dateValue}.html`;
            } else {
                preview.style.display = 'none';
            }
        }

        // ìƒˆ êµíšŒëª… ì…ë ¥ ì‹œ
        document.getElementById('newChurchName')?.addEventListener('input', updateChurchPreview);

        // í´ë” ì„ íƒ ì´ë²¤íŠ¸
        document.querySelectorAll('.folder-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.folder-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;

                const folderValue = this.dataset.folder;
                const customInput = document.getElementById('customFolderInput');

                if (folderValue === 'custom') {
                    customInput.classList.add('show');
                    selectedSaveFolder = document.getElementById('customFolderName').value.trim();
                } else {
                    customInput.classList.remove('show');
                    selectedSaveFolder = folderValue;
                }

                // ê¸°ì¡´ í´ë” ì„ íƒ í•´ì œ
                document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            });
        });

        // ì •ë‹¹ ì„ íƒ ë³€ê²½ ì‹œ
        document.getElementById('partyFolderSelect').addEventListener('change', function() {
            const customPartyInput = document.getElementById('customPartyInput');
            if (this.value === 'Other') {
                customPartyInput.style.display = 'block';
            } else {
                customPartyInput.style.display = 'none';
            }
            // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€ (ì¬í™•ì¸ í•„ìš”)
            document.getElementById('newFolderPreview').style.display = 'none';
        });

        // í›„ë³´ìëª… ì…ë ¥ ì‹œ
        document.getElementById('candidateFolderName').addEventListener('input', function() {
            // ê¸°ì¡´ í´ë” ì„ íƒ í•´ì œ
            document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€ (ì¬í™•ì¸ í•„ìš”)
            document.getElementById('newFolderPreview').style.display = 'none';
        });

        // ìƒˆ í´ë” ê²€ì¦ ë° ë¯¸ë¦¬ë³´ê¸° (ì •ë‹¹/í›„ë³´ìëª… êµ¬ì¡°)
        function validateNewFolder() {
            const partySelect = document.getElementById('partyFolderSelect').value;
            const customParty = document.getElementById('customPartyName').value.trim();
            const candidateName = document.getElementById('candidateFolderName').value.trim();

            // ì •ë‹¹ ê²°ì •
            let partyFolder = partySelect;
            if (partySelect === 'Other') {
                partyFolder = customParty;
            }

            if (!partyFolder) {
                alert('ì •ë‹¹ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!candidateName) {
                alert('í›„ë³´ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            // íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ (í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ í—ˆìš©)
            if (!/^[ê°€-í£a-zA-Z0-9\-_]+$/.test(partyFolder)) {
                alert('ì •ë‹¹ í´ë”ëª…ì—ëŠ” í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                return;
            }
            if (!/^[ê°€-í£a-zA-Z0-9\-_]+$/.test(candidateName)) {
                alert('í›„ë³´ìëª…ì—ëŠ” í•œê¸€, ì˜ë¬¸, ìˆ«ì, -, _ ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                return;
            }

            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            document.getElementById('previewPartyName').textContent = partyFolder;
            document.getElementById('previewCandidateName').textContent = candidateName;
            document.getElementById('newFolderPreview').style.display = 'block';

            // í´ë” ê²½ë¡œ ì„¤ì •: ì •ë‹¹/í›„ë³´ìëª…
            selectedSaveFolder = partyFolder + '/' + candidateName;
            createImagesFolder = true;  // images í´ë”ë„ ìƒì„±

            // í™•ì¸ í›„ PDF ì—…ë¡œë“œ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ë° ê°•ì¡°
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.style.border = '3px dashed #667eea';
            uploadArea.style.background = '#f0f4ff';
            uploadArea.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // 2ì´ˆ í›„ ì›ë˜ ìŠ¤íƒ€ì¼ë¡œ ë³µì›
            setTimeout(() => {
                uploadArea.style.border = '';
                uploadArea.style.background = '';
            }, 2000);
        }

        let createImagesFolder = false;  // images í´ë” ìƒì„± ì—¬ë¶€

        // ê¸°ì¡´ í´ë” ëª©ë¡ ë¡œë“œ
        async function loadExistingFolders() {
            try {
                const response = await fetch('/api/files/outputs');
                const data = await response.json();

                if (data.success && data.folders && data.folders.length > 0) {
                    const list = document.getElementById('existingFoldersList');
                    list.innerHTML = data.folders.map(folder => `
                        <span class="existing-folder-chip" data-folder="${folder.name}" onclick="selectExistingFolder('${folder.name}')">
                            ğŸ“ ${folder.name}
                            <small>(${folder.file_count}ê°œ)</small>
                        </span>
                    `).join('');
                } else {
                    document.getElementById('existingFolders').style.display = 'none';
                }
            } catch (e) {
                console.error('í´ë” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e);
                document.getElementById('existingFolders').style.display = 'none';
            }
        }

        // ê¸°ì¡´ í´ë” ì„ íƒ
        function selectExistingFolder(folderName) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.existing-folder-chip').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.folder-option').forEach(o => o.classList.remove('selected'));

            // ì„ íƒ í‘œì‹œ
            event.target.closest('.existing-folder-chip').classList.add('selected');
            selectedSaveFolder = folderName;
            createImagesFolder = false;  // ê¸°ì¡´ í´ë”ëŠ” images í´ë” ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìŒ

            // ì»¤ìŠ¤í…€ ì…ë ¥ ë° ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€
            document.getElementById('customFolderInput').classList.remove('show');
            document.getElementById('newFolderPreview').style.display = 'none';
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        async function checkStatus() {
            try {
                const response = await fetch('/api/auto-convert/status');
                const data = await response.json();

                if (data.auto_converter_ready) {
                    document.getElementById('statusDot').className = 'status-dot ready';
                    document.getElementById('statusText').textContent = 'ì‹œìŠ¤í…œ ì¤€ë¹„ë¨';
                } else {
                    document.getElementById('statusDot').className = 'status-dot error';
                    document.getElementById('statusText').textContent = 'ì‹œìŠ¤í…œ ì˜¤ë¥˜';
                }

                document.getElementById('visionStatus').textContent =
                    `Vision OCR: ${data.vision_ocr_ready ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`;

                // ì •ë‹¹ ìƒ‰ìƒ í‘œì‹œ
                const partyColors = document.getElementById('partyColors');
                partyColors.innerHTML = data.supported_parties.map(party => `
                    <div class="party-chip" style="background: ${party.color}20; color: ${party.color};">
                        <span class="dot" style="background: ${party.color};"></span>
                        ${party.name}
                    </div>
                `).join('');
            } catch (e) {
                console.error('ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', e);
            }
        }

        checkStatus();
        loadExistingFolders();

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            handleFiles(fileInput.files);
        });

        function handleFiles(files) {
            const pdfFiles = Array.from(files).filter(f => f.name.toLowerCase().endsWith('.pdf'));

            if (pdfFiles.length === 0) {
                showError('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            if (!batchMode.checked && pdfFiles.length > 1) {
                showError('ë‹¨ì¼ íŒŒì¼ ëª¨ë“œì…ë‹ˆë‹¤. ë‹¤ì¤‘ íŒŒì¼ì€ ì¼ê´„ ë³€í™˜ ëª¨ë“œë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                return;
            }

            selectedFiles = pdfFiles;
            renderFileList();
            updateConvertButton();
        }

        function renderFileList() {
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                uploadArea.classList.remove('has-file');
                return;
            }

            uploadArea.classList.add('has-file');

            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-info">
                    <span class="icon">ğŸ“„</span>
                    <div class="details">
                        <div class="name">${file.name}</div>
                        <div class="size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove" onclick="removeFile(${index})">ì‚­ì œ</button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
            updateConvertButton();
        }

        function updateConvertButton() {
            if (selectedFiles.length > 0) {
                convertBtn.disabled = false;
                convertBtn.className = 'convert-btn ready';
                if (currentMode === 'church') {
                    convertBtn.innerHTML = `<span>â›ª ì£¼ë³´ ìë™ ë³€í™˜ ì‹œì‘</span>`;
                } else {
                    convertBtn.innerHTML = `<span>ğŸš€ ${selectedFiles.length}ê°œ íŒŒì¼ ìë™ ë³€í™˜ ì‹œì‘</span>`;
                }
            } else {
                convertBtn.disabled = true;
                convertBtn.className = 'convert-btn disabled';
                if (currentMode === 'church') {
                    convertBtn.innerHTML = '<span>â›ª ì£¼ë³´ PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>';
                } else {
                    convertBtn.innerHTML = '<span>ğŸ“„ PDFë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>';
                }
            }
        }

        // ì ˆê¸° í…Œë§ˆ ì´ë¦„ ë°˜í™˜
        function getThemeName(theme) {
            const themeNames = {
                'default': 'ì¼ë°˜',
                'advent': 'ğŸ•¯ï¸ ëŒ€ë¦¼ì ˆ',
                'christmas': 'ğŸ„ ì„±íƒ„ì ˆ',
                'lent': 'âœï¸ ì‚¬ìˆœì ˆ',
                'easter': 'ğŸŒ¸ ë¶€í™œì ˆ',
                'pentecost': 'ğŸ”¥ ì„±ë ¹ê°•ë¦¼ì ˆ',
                'harvest': 'ğŸŒ¾ ì¶”ìˆ˜ê°ì‚¬ì ˆ'
            };
            return themeNames[theme] || theme || 'ì¼ë°˜';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function showError(message) {
            errorContainer.textContent = 'âŒ ' + message;
            errorContainer.classList.add('show');
            setTimeout(() => {
                errorContainer.classList.remove('show');
            }, 5000);
        }

        // ë³€í™˜ ì‹¤í–‰
        convertBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) return;

            errorContainer.classList.remove('show');
            resultContainer.classList.remove('show');

            convertBtn.disabled = true;
            convertBtn.className = 'convert-btn loading';
            convertBtn.innerHTML = '<span>ë³€í™˜ ì¤‘...</span>';

            progressContainer.classList.add('show');
            progressFill.style.width = '10%';
            progressText.textContent = 'PDF ë¶„ì„ ì¤‘...';

            try {
                let result;

                if (currentMode === 'church') {
                    // êµíšŒ ì£¼ë³´ ë³€í™˜
                    result = await convertChurchBulletin(selectedFiles[0]);
                } else if (selectedFiles.length === 1) {
                    // ë‹¨ì¼ íŒŒì¼ ë³€í™˜ (ì„ ê±°)
                    result = await convertSingle(selectedFiles[0]);
                } else {
                    // ì¼ê´„ ë³€í™˜ (ì„ ê±°)
                    result = await convertBatch(selectedFiles);
                }

                progressFill.style.width = '100%';
                progressText.textContent = 'ì™„ë£Œ!';

                setTimeout(() => {
                    progressContainer.classList.remove('show');
                    showResult(result);
                }, 500);

            } catch (error) {
                progressContainer.classList.remove('show');
                showError(error.message);
                updateConvertButton();
            }
        });

        // êµíšŒ ì£¼ë³´ ë³€í™˜ í•¨ìˆ˜
        async function convertChurchBulletin(file) {
            const newChurchInput = document.getElementById('newChurchName');
            const churchName = document.getElementById('churchSelect').value === 'new'
                ? newChurchInput.value.trim()
                : selectedChurch;

            if (!churchName) {
                throw new Error('êµíšŒëª…ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }

            if (!bulletinDate) {
                throw new Error('ì£¼ë³´ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('church_name', churchName);
            formData.append('bulletin_date', bulletinDate);
            formData.append('theme', selectedChurchTheme);

            progressFill.style.width = '30%';
            progressText.textContent = 'ì£¼ë³´ ë‚´ìš© ë¶„ì„ ì¤‘...';

            await new Promise(r => setTimeout(r, 500));
            progressFill.style.width = '50%';
            progressText.textContent = 'ì˜ˆë°° ìˆœì„œ ì¶”ì¶œ ì¤‘...';

            const response = await fetch('/api/church-convert', {
                method: 'POST',
                body: formData
            });

            progressFill.style.width = '80%';
            progressText.textContent = 'HTML ìƒì„± ì¤‘...';

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'ì£¼ë³´ ë³€í™˜ ì‹¤íŒ¨');
            }

            return await response.json();
        }

        async function convertSingle(file) {
            const formData = new FormData();
            formData.append('file', file);

            // ì €ì¥ í´ë” ì¶”ê°€
            if (selectedSaveFolder) {
                formData.append('save_folder', selectedSaveFolder);
            }

            // images í´ë” ìƒì„± ì—¬ë¶€
            if (createImagesFolder) {
                formData.append('create_images_folder', 'true');
            }

            progressFill.style.width = '30%';
            progressText.textContent = 'ì •ë‹¹ ê°ì§€ ì¤‘...';

            await new Promise(r => setTimeout(r, 500));
            progressFill.style.width = '50%';
            progressText.textContent = 'ê³µì•½ ì¶”ì¶œ ì¤‘...';

            const response = await fetch('/api/auto-convert', {
                method: 'POST',
                body: formData
            });

            progressFill.style.width = '80%';
            progressText.textContent = 'HTML ìƒì„± ì¤‘...';

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'ë³€í™˜ ì‹¤íŒ¨');
            }

            return await response.json();
        }

        async function convertBatch(files) {
            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });

            progressFill.style.width = '30%';
            progressText.textContent = `${files.length}ê°œ íŒŒì¼ ì¼ê´„ ë³€í™˜ ì¤‘...`;

            const response = await fetch('/api/batch-convert', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'ì¼ê´„ ë³€í™˜ ì‹¤íŒ¨');
            }

            return await response.json();
        }

        function showResult(data) {
            resultContainer.classList.add('show');

            const resultInfo = document.getElementById('resultInfo');
            const previewBtn = document.getElementById('previewBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadFolderBtn = document.getElementById('downloadFolderBtn');

            // êµíšŒ ì£¼ë³´ ê²°ê³¼
            if (data.church_name || data.bulletin_date) {
                resultInfo.innerHTML = `
                    <div class="result-item">
                        <div class="label">êµíšŒ</div>
                        <div class="value">â›ª ${data.church_name || 'ë³€í™˜ë¨'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ë‚ ì§œ</div>
                        <div class="value">${data.bulletin_date || ''}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì ˆê¸°</div>
                        <div class="value">${getThemeName(data.theme) || 'ì¼ë°˜'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">í˜ì´ì§€</div>
                        <div class="value">${data.page_count || 0}í˜ì´ì§€</div>
                    </div>
                `;

                previewBtn.href = data.url;
                downloadBtn.href = data.url;
                downloadBtn.download = data.filename;
                downloadFolderBtn.style.display = 'none';
            }
            // ì„ ê±° ë‹¨ì¼ íŒŒì¼ ê²°ê³¼
            else if (data.result) {
                const result = data.result;
                resultInfo.innerHTML = `
                    <div class="result-item">
                        <div class="label">í›„ë³´ì</div>
                        <div class="value">${result.candidate?.name || 'ì¶”ì¶œë¨'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì •ë‹¹</div>
                        <div class="value">${result.candidate?.party || 'ê°ì§€ë¨'}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ê³µì•½ ìˆ˜</div>
                        <div class="value">${result.statistics?.pledge_count || 0}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">í˜ì´ì§€</div>
                        <div class="value">${result.statistics?.page_count || 0}í˜ì´ì§€</div>
                    </div>
                `;

                previewBtn.href = result.url;
                downloadBtn.href = result.url;
                downloadBtn.download = result.filename;

                // í´ë” ZIP ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì„¤ì •
                if (selectedSaveFolder) {
                    downloadFolderBtn.href = `/api/download/folder/${encodeURIComponent(selectedSaveFolder)}`;
                    downloadFolderBtn.style.display = 'inline-block';
                } else {
                    downloadFolderBtn.style.display = 'none';
                }
            } else if (data.results) {
                // ì¼ê´„ ë³€í™˜ ê²°ê³¼
                const successCount = data.statistics.success;
                const failCount = data.statistics.failed;

                resultInfo.innerHTML = `
                    <div class="result-item">
                        <div class="label">ì´ íŒŒì¼</div>
                        <div class="value">${data.statistics.total}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì„±ê³µ</div>
                        <div class="value" style="color: #10B981;">${successCount}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ì‹¤íŒ¨</div>
                        <div class="value" style="color: ${failCount > 0 ? '#EF4444' : 'inherit'};">${failCount}ê°œ</div>
                    </div>
                    <div class="result-item">
                        <div class="label">ìƒíƒœ</div>
                        <div class="value">${successCount === data.statistics.total ? 'ëª¨ë‘ ì„±ê³µ' : 'ì¼ë¶€ ì‹¤íŒ¨'}</div>
                    </div>
                `;

                // ì²« ë²ˆì§¸ ì„±ê³µí•œ íŒŒì¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
                const firstSuccess = data.results.find(r => r.success);
                if (firstSuccess) {
                    previewBtn.href = firstSuccess.output_url;
                    previewBtn.textContent = 'ì²« ë²ˆì§¸ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°';
                } else {
                    previewBtn.style.display = 'none';
                }
                downloadBtn.style.display = 'none';
                downloadFolderBtn.style.display = 'none';
            }

            convertBtn.innerHTML = '<span>âœ… ë³€í™˜ ì™„ë£Œ</span>';
            convertBtn.className = 'convert-btn ready';
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            selectedFiles = [];
            renderFileList();
            updateConvertButton();
            resultContainer.classList.remove('show');
            fileInput.value = '';
        });
    </script>
</body>
</html>
