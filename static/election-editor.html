<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ ê±° ì „ë¬¸ í¸ì§‘ê¸° - StudySnap</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            /* ì„ ê±° í…Œë§ˆ - ëŒ€í•œë¯¼êµ­ êµ­ê¸° ì»¬ëŸ¬ + ì‹ ë¢°ê° ë¸”ë£¨ */
            --primary: #1e3a8a;
            --primary-dark: #1e3a5f;
            --primary-light: #dbeafe;
            --accent: #dc2626;
            --accent-light: #fee2e2;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --text-dark: #1f2937;
            --text-gray: #6B7280;
            --bg-gray: #f1f5f9;
            --border: #e2e8f0;
            --white: #FFFFFF;
            /* ì •ë‹¹ ì»¬ëŸ¬ */
            --party-blue: #004EA2;
            --party-red: #E61E2B;
            --party-orange: #FF7210;
            --party-green: #00A651;
            --party-yellow: #FFCC00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-gray);
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 1.2em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-badge {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .file-info {
            font-size: 0.85em;
            opacity: 0.9;
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 6px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.3);
        }

        .nav-link.active {
            background: var(--accent);
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.5);
            color: white;
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-primary {
            background: var(--success);
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #b91c1c;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: calc(100vh - 52px);
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            background: var(--white);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: var(--bg-gray);
            border: none;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            color: var(--text-gray);
            transition: all 0.2s;
        }

        .sidebar-tab.active {
            background: var(--white);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        /* íŒŒì¼ íƒìƒ‰ê¸° */
        .file-explorer {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .breadcrumb {
            padding: 8px 12px;
            background: var(--primary-light);
            border-bottom: 1px solid var(--border);
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            color: var(--primary);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .breadcrumb-item:hover {
            background: #DBEAFE;
        }

        .breadcrumb-separator {
            color: #9CA3AF;
        }

        .breadcrumb-current {
            color: var(--text-dark);
            font-weight: 600;
        }

        .file-list {
            flex: 1;
            overflow-y: auto;
        }

        .folder-item, .file-item {
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #FEF7E8;
        }

        .folder-item:hover {
            background: #FEF3C7;
        }

        .folder-name {
            font-size: 0.85em;
            color: #92400E;
            font-weight: 500;
        }

        .file-item:hover {
            background: var(--bg-gray);
        }

        .file-item.active {
            background: var(--primary-light);
            border-left: 3px solid var(--primary);
        }

        .file-name {
            font-size: 0.85em;
            color: var(--text-dark);
            margin-bottom: 2px;
            word-break: break-all;
        }

        .file-time {
            font-size: 0.7em;
            color: var(--text-gray);
        }

        /* ì„ ê±° ì „ìš© ë„êµ¬ íŒ¨ë„ */
        .tools-panel {
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .tools-panel.active {
            display: flex;
            flex: 1;
        }

        .tool-section {
            border-bottom: 1px solid var(--border);
        }

        .tool-section-header {
            padding: 10px 14px;
            background: var(--bg-gray);
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .tool-section-header:hover {
            background: var(--primary-light);
        }

        .tool-section-content {
            padding: 10px;
            display: none;
        }

        .tool-section.open .tool-section-content {
            display: block;
        }

        .tool-btn {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .tool-btn-icon {
            font-size: 1.3em;
        }

        .tool-btn-text {
            flex: 1;
        }

        .tool-btn-title {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .tool-btn-desc {
            font-size: 0.75em;
            color: var(--text-gray);
        }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .content-area {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ê³µí†µ + ì„ ê±° ì „ìš© íˆ´ë°” */
        .toolbar {
            display: flex;
            padding: 8px 12px;
            background: var(--white);
            border-bottom: 1px solid var(--border);
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            padding-right: 10px;
            border-right: 1px solid var(--border);
            margin-right: 6px;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-group-label {
            font-size: 0.7em;
            color: var(--text-gray);
            padding: 0 8px;
            align-self: center;
        }

        .toolbar-btn {
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar-btn:hover {
            background: var(--bg-gray);
        }

        .toolbar-btn.election-tool {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .toolbar-btn.election-tool:hover {
            background: #bfdbfe;
        }

        /* ë¶„í•  ë·° */
        .split-view {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            border-right: 1px solid var(--border);
        }

        .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }

        .pane-header {
            padding: 8px 12px;
            background: var(--bg-gray);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pane-title {
            font-weight: 600;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .resizer {
            width: 6px;
            background: var(--border);
            cursor: col-resize;
            transition: background 0.2s;
        }

        .resizer:hover {
            background: var(--primary);
        }

        /* ì½”ë“œ ì—ë””í„° */
        .editor-content {
            flex: 1;
            padding: 10px;
            overflow: hidden;
        }

        #htmlEditor {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: none;
            background: #FEFEFE;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
            background: #e2e8f0;
            overflow: auto;
        }

        .preview-device {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: all 0.3s;
        }

        .preview-device.desktop {
            width: 100%;
            height: 100%;
        }

        .preview-device.tablet {
            width: 768px;
            height: 100%;
            border-radius: 12px;
        }

        .preview-device.mobile {
            width: 375px;
            height: 100%;
            border-radius: 24px;
            border: 10px solid #333;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-size-btns {
            display: flex;
            gap: 4px;
        }

        .preview-size-btn {
            padding: 4px 8px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75em;
        }

        .preview-size-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ìƒíƒœë°” */
        .status-bar {
            padding: 6px 12px;
            background: var(--bg-gray);
            border-top: 1px solid var(--border);
            font-size: 0.75em;
            color: var(--text-gray);
            display: flex;
            justify-content: space-between;
        }

        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 60px;
            right: 20px;
            padding: 12px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: none;
            z-index: 9999;
            animation: slideIn 0.3s;
        }

        .notification.show {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.success { border-left: 4px solid var(--success); }
        .notification.error { border-left: 4px solid var(--danger); }
        .notification.info { border-left: 4px solid var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-gray);
        }

        .modal-close:hover {
            color: var(--text-dark);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ì •ë‹¹ ì„ íƒ */
        .party-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .party-option {
            padding: 12px 8px;
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .party-option:hover {
            border-color: var(--primary);
        }

        .party-option.selected {
            border-width: 3px;
        }

        .party-option.blue { --party-color: #004EA2; }
        .party-option.red { --party-color: #E61E2B; }
        .party-option.orange { --party-color: #FF7210; }
        .party-option.green { --party-color: #00A651; }
        .party-option.gray { --party-color: #6B7280; }

        .party-option.selected {
            border-color: var(--party-color);
            background: color-mix(in srgb, var(--party-color) 10%, white);
        }

        .party-symbol {
            font-size: 1.5em;
            margin-bottom: 4px;
        }

        .party-name {
            font-size: 0.75em;
            font-weight: 600;
        }

        /* í›„ë³´ì ì¹´ë“œ ë¯¸ë¦¬ë³´ê¸° */
        .candidate-preview {
            background: var(--bg-gray);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .candidate-card {
            display: flex;
            gap: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .candidate-photo {
            width: 120px;
            height: 150px;
            background: var(--bg-gray);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: var(--text-gray);
        }

        .candidate-info {
            flex: 1;
        }

        .candidate-party {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .candidate-name {
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .candidate-slogan {
            color: var(--text-gray);
            font-size: 0.95em;
        }

        /* ê³µì•½ ì¹´ë“œ */
        .pledge-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }

        .pledge-number {
            display: inline-flex;
            width: 28px;
            height: 28px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85em;
            margin-right: 10px;
        }

        /* ì§€ì—­ ì„ íƒ */
        .region-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: var(--bg-gray);
            border-radius: 8px;
        }

        .region-btn {
            padding: 8px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .region-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .region-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* AI ì±„íŒ… */
        .ai-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 9997;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-fab:hover {
            transform: scale(1.1);
        }

        .ai-fab.hidden {
            display: none;
        }

        .ai-chat-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 9998;
        }

        .ai-chat-overlay.active {
            display: flex;
        }

        .ai-chat-header {
            padding: 14px 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-message {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .ai-message.user {
            background: var(--primary-light);
            align-self: flex-end;
        }

        .ai-message.assistant {
            background: var(--bg-gray);
            align-self: flex-start;
        }

        .ai-chat-input {
            padding: 12px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-left">
            <div class="logo">
                <span>ğŸ—³ï¸</span>
                <span>ì„ ê±° ê³µë³´ë¬¼</span>
                <span class="category-badge">Election</span>
            </div>
            <div class="header-nav">
                <a href="/static/explorer.html" class="nav-link">ğŸ—‚ï¸ íƒìƒ‰ê¸°</a>
                <a href="/static/church-editor.html" class="nav-link">ğŸ•Šï¸ ì£¼ë³´</a>
                <a href="/static/election-editor.html" class="nav-link active">ğŸ—³ï¸ ì„ ê±°</a>
                <a href="/static/editor.html" class="nav-link">ğŸ“ ì¼ë°˜</a>
            </div>
            <div class="file-info" id="currentFileInfo">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline" onclick="loadFiles()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn btn-accent" onclick="saveFile()">ğŸ’¾ ì €ì¥</button>
            <button class="btn btn-outline" onclick="downloadFile()">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ</button>
            <button class="btn btn-primary" onclick="downloadWithImages()">ğŸ“¦ ZIP</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" onclick="switchSidebarTab('files')">ğŸ“ íŒŒì¼</button>
                <button class="sidebar-tab" onclick="switchSidebarTab('tools')">ğŸ› ï¸ ë„êµ¬</button>
            </div>

            <!-- íŒŒì¼ íƒìƒ‰ê¸° -->
            <div class="file-explorer" id="filesPanel">
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-current">ğŸ“ Election</span>
                </div>
                <div class="file-list" id="fileList">
                    <div style="padding: 20px; text-align: center; color: var(--text-gray);">
                        ğŸ“‚ íŒŒì¼ ë¡œë”© ì¤‘...
                    </div>
                </div>
            </div>

            <!-- ì„ ê±° ì „ìš© ë„êµ¬ íŒ¨ë„ -->
            <div class="tools-panel" id="toolsPanel">
                <div class="tool-section open">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ‘¤</span> í›„ë³´ì ì •ë³´
                        <span style="margin-left: auto;">â–¼</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openCandidateModal()">
                            <span class="tool-btn-icon">ğŸªª</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">í›„ë³´ì ì¹´ë“œ</div>
                                <div class="tool-btn-desc">ê¸°í˜¸, ì´ë¦„, ì •ë‹¹, ìŠ¬ë¡œê±´</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openDeclarationModal()">
                            <span class="tool-btn-icon">ğŸ“œ</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì¶œì‚¬í‘œ</div>
                                <div class="tool-btn-desc">ì…í›„ë³´ ì„ ì–¸ë¬¸</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openProfileModal()">
                            <span class="tool-btn-icon">ğŸ“‹</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">í”„ë¡œí•„ ì¹´ë“œ</div>
                                <div class="tool-btn-desc">í•™ë ¥, SNS, ì—°ë½ì²˜</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ“‹</span> ê³µì•½/ê²½ë ¥
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openPledgeModal()">
                            <span class="tool-btn-icon">ğŸ¯</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">í•µì‹¬ ê³µì•½</div>
                                <div class="tool-btn-desc">ë²ˆí˜¸ ê°•ì¡° ê³µì•½ ì¹´ë“œ</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openDetailedPledgeModal()">
                            <span class="tool-btn-icon">ğŸ“„</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ìƒì„¸ ê³µì•½</div>
                                <div class="tool-btn-desc">ë¶„ì•¼ë³„ ìƒì„¸ ê³µì•½ í˜ì´ì§€</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openCareerModal()">
                            <span class="tool-btn-icon">ğŸ’¼</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ê²½ë ¥/ì´ë ¥</div>
                                <div class="tool-btn-desc">ê²½ë ¥ ë° ìˆ˜ìƒ ë‚´ì—­</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ—ºï¸</span> ì§€ì—­/ì§€ë„
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openRegionModal()">
                            <span class="tool-btn-icon">ğŸ“</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì§€ì—­êµ¬ ì§€ë„</div>
                                <div class="tool-btn-desc">ì‹œ/ë„, êµ¬/êµ° ë‹¨ìœ„ ì§€ë„</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openDistrictModal()">
                            <span class="tool-btn-icon">ğŸ˜ï¸</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì„ ê±°êµ¬ ì •ë³´</div>
                                <div class="tool-btn-desc">ì„ ê±°êµ¬ ê²½ê³„ ë° í˜„í™©</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ”—</span> SNS/ì—°ë½ì²˜
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openSnsModal()">
                            <span class="tool-btn-icon">ğŸ“±</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">SNS ë§í¬</div>
                                <div class="tool-btn-desc">YouTube, ì¸ìŠ¤íƒ€ ë“±</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openContactModal()">
                            <span class="tool-btn-icon">â˜ï¸</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì—°ë½ì²˜</div>
                                <div class="tool-btn-desc">ì„ ê±°ì‚¬ë¬´ì†Œ ì—°ë½ì²˜</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì»¨í…ì¸  ì˜ì—­ -->
        <div class="content-area">
            <!-- ê³µí†µ + ì„ ê±° ì „ìš© íˆ´ë°” -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <span class="toolbar-group-label">ê³µí†µ</span>
                    <button class="toolbar-btn" onclick="formatText('bold')" title="êµµê²Œ"><b>B</b></button>
                    <button class="toolbar-btn" onclick="formatText('italic')" title="ê¸°ìš¸ì„"><i>I</i></button>
                    <button class="toolbar-btn" onclick="formatText('underline')" title="ë°‘ì¤„"><u>U</u></button>
                    <button class="toolbar-btn" onclick="insertElement('h1')">H1</button>
                    <button class="toolbar-btn" onclick="insertElement('h2')">H2</button>
                </div>
                <div class="toolbar-group">
                    <span class="toolbar-group-label">ì„ ê±°ì „ìš©</span>
                    <button class="toolbar-btn election-tool" onclick="openCandidateModal()" title="í›„ë³´ì ì¹´ë“œ">ğŸªª</button>
                    <button class="toolbar-btn election-tool" onclick="openPledgeModal()" title="ê³µì•½">ğŸ¯</button>
                    <button class="toolbar-btn election-tool" onclick="openCareerModal()" title="ê²½ë ¥">ğŸ’¼</button>
                    <button class="toolbar-btn election-tool" onclick="openRegionModal()" title="ì§€ì—­êµ¬">ğŸ“</button>
                    <button class="toolbar-btn election-tool" onclick="openProfileModal()" title="í”„ë¡œí•„">ğŸ“‹</button>
                </div>
                <div class="toolbar-group">
                    <span class="toolbar-group-label">í¸ì§‘</span>
                    <button class="toolbar-btn" onclick="beautifyHTML()">ğŸ§¹ ì½”ë“œì •ë¦¬</button>
                    <button class="toolbar-btn" onclick="findReplace()">ğŸ” ì°¾ê¸°</button>
                </div>
            </div>

            <!-- ë¶„í•  ë·° -->
            <div class="split-view">
                <div class="editor-pane" id="editorPane">
                    <div class="pane-header">
                        <span class="pane-title">âœï¸ HTML í¸ì§‘</span>
                        <span id="charCount" style="font-size: 0.8em; color: var(--text-gray);">0ì</span>
                    </div>
                    <div class="editor-content">
                        <textarea id="htmlEditor" placeholder="HTML íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
                    </div>
                </div>

                <div class="resizer" id="resizer"></div>

                <div class="preview-pane" id="previewPane">
                    <div class="pane-header">
                        <span class="pane-title">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</span>
                        <div class="preview-size-btns">
                            <button class="preview-size-btn" onclick="setPreviewSize('desktop')">ğŸ–¥ï¸</button>
                            <button class="preview-size-btn active" onclick="setPreviewSize('mobile')">ğŸ“±</button>
                            <button class="preview-size-btn" onclick="setPreviewSize('tablet')">ğŸ“Ÿ</button>
                        </div>
                    </div>
                    <div class="preview-wrapper">
                        <div class="preview-device mobile" id="previewDevice">
                            <iframe id="previewFrame" class="preview-frame"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìƒíƒœë°” -->
            <div class="status-bar">
                <span id="statusText">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                <span>ì„ ê±° ì „ë¬¸ í¸ì§‘ê¸° v1.0</span>
            </div>
        </div>
    </div>

    <!-- AI ì±„íŒ… FAB -->
    <button class="ai-fab" id="aiFab" onclick="toggleAiChat()">ğŸ¤–</button>

    <!-- AI ì±„íŒ… íŒ¨ë„ -->
    <div class="ai-chat-overlay" id="aiChatPanel">
        <div class="ai-chat-header">
            <span>ğŸ¤– AI ì„ ê±° ë„ìš°ë¯¸</span>
            <button class="modal-close" onclick="toggleAiChat()">&times;</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message assistant">
                ì•ˆë…•í•˜ì„¸ìš”! ì„ ê±° ê³µë³´ë¬¼ í¸ì§‘ì„ ë„ì™€ë“œë¦´ê²Œìš”. ì˜ˆë¥¼ ë“¤ì–´:
                <br>â€¢ "í›„ë³´ì ì‚¬ì§„ì„ ë” í¬ê²Œ"
                <br>â€¢ "ê³µì•½ ì¹´ë“œ ìƒ‰ìƒ ë³€ê²½"
                <br>â€¢ "ê²½ë ¥ ì„¹ì…˜ ì¶”ê°€í•´ì¤˜"
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="ìˆ˜ì • ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleAiInputKeypress(event)">
            <button class="btn btn-primary" onclick="sendAiMessage()">ì „ì†¡</button>
        </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div id="notification" class="notification"></div>

    <!-- í›„ë³´ì ì¹´ë“œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="candidateModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸªª í›„ë³´ì ì¹´ë“œ ì‚½ì…</span>
                <button class="modal-close" onclick="closeCandidateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ê¸°í˜¸</label>
                    <input type="number" class="form-input" id="candidateNumber" placeholder="ì˜ˆ: 1" min="1" max="20" style="width: 100px;">
                </div>
                <div class="form-group">
                    <label class="form-label">ì •ë‹¹ ì„ íƒ</label>
                    <div class="party-selector" id="partySelector">
                        <div class="party-option blue" onclick="selectParty(this, 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', '#004EA2')">
                            <div class="party-symbol">ğŸ”µ</div>
                            <div class="party-name">ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹</div>
                        </div>
                        <div class="party-option red" onclick="selectParty(this, 'êµ­ë¯¼ì˜í˜', '#E61E2B')">
                            <div class="party-symbol">ğŸ”´</div>
                            <div class="party-name">êµ­ë¯¼ì˜í˜</div>
                        </div>
                        <div class="party-option orange" onclick="selectParty(this, 'ê°œí˜ì‹ ë‹¹', '#FF7210')">
                            <div class="party-symbol">ğŸŸ </div>
                            <div class="party-name">ê°œí˜ì‹ ë‹¹</div>
                        </div>
                        <div class="party-option green" onclick="selectParty(this, 'ë…¹ìƒ‰ì •ì˜ë‹¹', '#00A651')">
                            <div class="party-symbol">ğŸŸ¢</div>
                            <div class="party-name">ë…¹ìƒ‰ì •ì˜ë‹¹</div>
                        </div>
                        <div class="party-option gray" onclick="selectParty(this, 'ë¬´ì†Œì†', '#6B7280')">
                            <div class="party-symbol">âšª</div>
                            <div class="party-name">ë¬´ì†Œì†</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">í›„ë³´ì ì´ë¦„</label>
                    <input type="text" class="form-input" id="candidateName" placeholder="ì˜ˆ: í™ê¸¸ë™">
                </div>
                <div class="form-group">
                    <label class="form-label">ì„ ê±°êµ¬</label>
                    <input type="text" class="form-input" id="candidateDistrict" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ê°‘">
                </div>
                <div class="form-group">
                    <label class="form-label">ìŠ¬ë¡œê±´</label>
                    <input type="text" class="form-input" id="candidateSlogan" placeholder="ì˜ˆ: ë³€í™”ì™€ í˜ì‹ ì˜ ë¦¬ë”">
                </div>
                <div class="form-group">
                    <label class="form-label">í›„ë³´ì ì‚¬ì§„ URL (ì„ íƒ)</label>
                    <input type="text" class="form-input" id="candidatePhoto" placeholder="https://...">
                </div>
                <div class="candidate-preview" id="candidatePreview">
                    <div class="candidate-card">
                        <div class="candidate-photo" id="previewPhoto">ğŸ‘¤</div>
                        <div class="candidate-info">
                            <div class="candidate-party" id="previewParty" style="background: #6B7280; color: white;">ì •ë‹¹ ì„ íƒ</div>
                            <div class="candidate-name" id="previewName">í›„ë³´ì ì´ë¦„</div>
                            <div class="candidate-slogan" id="previewSlogan">ìŠ¬ë¡œê±´ì„ ì…ë ¥í•˜ì„¸ìš”</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeCandidateModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertCandidateCard()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ê³µì•½ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="pledgeModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ¯ í•µì‹¬ ê³µì•½ ì‚½ì…</span>
                <button class="modal-close" onclick="closePledgeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ê³µì•½ ìˆ˜</label>
                    <select class="form-select" id="pledgeCount" onchange="updatePledgeInputs()">
                        <option value="3">3ê°œ</option>
                        <option value="5" selected>5ê°œ</option>
                        <option value="7">7ê°œ</option>
                        <option value="10">10ê°œ</option>
                    </select>
                </div>
                <div id="pledgeInputs">
                    <!-- ë™ì  ìƒì„± -->
                </div>
                <div class="form-group">
                    <label class="form-label">ìŠ¤íƒ€ì¼</label>
                    <select class="form-select" id="pledgeStyle">
                        <option value="cards">ì¹´ë“œí˜•</option>
                        <option value="list">ëª©ë¡í˜•</option>
                        <option value="grid">ê·¸ë¦¬ë“œí˜•</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closePledgeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertPledges()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ê²½ë ¥ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="careerModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ’¼ ê²½ë ¥/ì´ë ¥ ì‚½ì…</span>
                <button class="modal-close" onclick="closeCareerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ê²½ë ¥ (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                    <textarea class="form-textarea" id="careerList" placeholder="ì˜ˆ:
ì„œìš¸ëŒ€í•™êµ ë²•í•™ê³¼ ì¡¸ì—…
ì œ20ëŒ€ êµ­íšŒì˜ì›
ë²•ë¬´ë¶€ ì°¨ê´€
ëŒ€í•œë³€í˜¸ì‚¬í˜‘íšŒ íšŒì¥"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ì£¼ìš” ìˆ˜ìƒ (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                    <textarea class="form-textarea" id="awardList" placeholder="ì˜ˆ:
2020ë…„ ì˜ì •í™œë™ ìš°ìˆ˜ êµ­íšŒì˜ì›ìƒ
2019ë…„ ì²­ë ´ êµ­íšŒì˜ì›ìƒ" style="min-height: 80px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ìŠ¤íƒ€ì¼</label>
                    <select class="form-select" id="careerStyle">
                        <option value="timeline">íƒ€ì„ë¼ì¸</option>
                        <option value="list">ëª©ë¡í˜•</option>
                        <option value="cards">ì¹´ë“œí˜•</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeCareerModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertCareer()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ì§€ì—­êµ¬ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="regionModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ“ ì§€ì—­êµ¬ ì •ë³´ ì‚½ì…</span>
                <button class="modal-close" onclick="closeRegionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ì‹œ/ë„ ì„ íƒ</label>
                    <select class="form-select" id="regionProvince" onchange="updateDistricts()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                        <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                        <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                        <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                        <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                        <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                        <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                        <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                        <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                        <option value="ê°•ì›ë„">ê°•ì›ë„</option>
                        <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                        <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                        <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
                        <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                        <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                        <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                        <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">êµ¬/êµ° ì„ íƒ</label>
                    <div class="region-grid" id="districtGrid">
                        <div style="padding: 20px; text-align: center; color: var(--text-gray); grid-column: 1/-1;">
                            ì‹œ/ë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì„ ê±°êµ¬ëª… (ê°‘/ì„/ë³‘)</label>
                    <select class="form-select" id="regionSection">
                        <option value="">í•´ë‹¹ì—†ìŒ</option>
                        <option value="ê°‘">ê°‘</option>
                        <option value="ì„">ì„</option>
                        <option value="ë³‘">ë³‘</option>
                        <option value="ì •">ì •</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeRegionModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertRegionInfo()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œí•„ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ“‹ í”„ë¡œí•„ ì¹´ë“œ ì‚½ì…</span>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">í•™ë ¥ (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                    <textarea class="form-textarea" id="profileEducation" placeholder="ì˜ˆ:
ì„œìš¸ëŒ€í•™êµ ë²•í•™ê³¼ ì¡¸ì—…
í•˜ë²„ë“œ ëŒ€í•™êµ í–‰ì •í•™ ì„ì‚¬"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">SNS (ì„ íƒ)</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" class="form-input" id="profileYoutube" placeholder="YouTube URL">
                        <input type="text" class="form-input" id="profileInstagram" placeholder="Instagram URL">
                        <input type="text" class="form-input" id="profileFacebook" placeholder="Facebook URL">
                        <input type="text" class="form-input" id="profileBlog" placeholder="ë¸”ë¡œê·¸/í™ˆí˜ì´ì§€ URL">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì—°ë½ì²˜</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" class="form-input" id="profilePhone" placeholder="ì„ ê±°ì‚¬ë¬´ì†Œ ì „í™”">
                        <input type="text" class="form-input" id="profileEmail" placeholder="ì´ë©”ì¼">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeProfileModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertProfile()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <script>
        // =========================================
        // ì „ì—­ ë³€ìˆ˜
        // =========================================
        let currentFile = null;
        let originalContent = '';
        let currentPath = 'Election';  // ì„ ê±°ëŠ” Election í´ë” ê¸°ë³¸
        let previewUpdateTimer = null;
        let selectedParty = { name: 'ë¬´ì†Œì†', color: '#6B7280' };
        let selectedDistrict = '';

        // ì§€ì—­ ë°ì´í„°
        const districtData = {
            'ì„œìš¸íŠ¹ë³„ì‹œ': ['ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ìš©ì‚°êµ¬', 'ì„±ë™êµ¬', 'ê´‘ì§„êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ì¤‘ë‘êµ¬', 'ì„±ë¶êµ¬', 'ê°•ë¶êµ¬', 'ë„ë´‰êµ¬', 'ë…¸ì›êµ¬', 'ì€í‰êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ë§ˆí¬êµ¬', 'ì–‘ì²œêµ¬', 'ê°•ì„œêµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ë™ì‘êµ¬', 'ê´€ì•…êµ¬', 'ì„œì´ˆêµ¬', 'ê°•ë‚¨êµ¬', 'ì†¡íŒŒêµ¬', 'ê°•ë™êµ¬'],
            'ë¶€ì‚°ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°'],
            'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ì•ˆì–‘ì‹œ', 'ë¶€ì²œì‹œ', 'ê´‘ëª…ì‹œ', 'í‰íƒì‹œ', 'ë™ë‘ì²œì‹œ', 'ì•ˆì‚°ì‹œ', 'ê³ ì–‘ì‹œ', 'ê³¼ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì‹œí¥ì‹œ', 'êµ°í¬ì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ìš©ì¸ì‹œ', 'íŒŒì£¼ì‹œ', 'ì´ì²œì‹œ', 'ì•ˆì„±ì‹œ', 'ê¹€í¬ì‹œ', 'í™”ì„±ì‹œ', 'ê´‘ì£¼ì‹œ', 'ì–‘ì£¼ì‹œ', 'í¬ì²œì‹œ', 'ì—¬ì£¼ì‹œ', 'ì—°ì²œêµ°', 'ê°€í‰êµ°', 'ì–‘í‰êµ°']
        };

        // =========================================
        // ì´ˆê¸°í™”
        // =========================================
        document.addEventListener('DOMContentLoaded', () => {
            loadFiles();
            setupResizer();
            setupEditorEvents();
            updatePledgeInputs();
        });

        // =========================================
        // íŒŒì¼ íƒìƒ‰ê¸° (ê³µí†µ ì½”ë“œ)
        // =========================================
        async function loadFiles() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“‚ ë¡œë”© ì¤‘...</div>';
            updateBreadcrumb();

            try {
                let apiUrl = '/api/files/outputs';
                if (currentPath) {
                    // í•œê¸€ ê²½ë¡œ ì¸ì½”ë”© ì²˜ë¦¬
                    const encodedPath = currentPath.split('/').map(p => encodeURIComponent(p)).join('/');
                    apiUrl += '/' + encodedPath;
                }
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.success) {
                    displayFiles(data.folders || [], data.files || []);
                } else {
                    fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                fileList.innerHTML = `<div style="padding: 20px; text-align: center; color: var(--danger);">âŒ ë¡œë“œ ì‹¤íŒ¨</div>`;
            }
        }

        function displayFiles(folders, files) {
            const fileList = document.getElementById('fileList');
            if (folders.length === 0 && files.length === 0) {
                fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            let html = '';

            folders.forEach(folder => {
                const folderName = typeof folder === 'string' ? folder : folder.name;
                const folderPath = currentPath ? currentPath + '/' + folderName : folderName;
                const fileCount = folder.file_count || 0;
                html += `
                    <div class="folder-item" onclick="navigateTo('${folderPath}')">
                        <span>ğŸ“</span>
                        <span class="folder-name">${folderName}</span>
                        ${fileCount > 0 ? `<span style="margin-left: auto; font-size: 0.75em; color: #92400E;">(${fileCount})</span>` : ''}
                    </div>
                `;
            });

            files.forEach(file => {
                const filePath = currentPath ? 'outputs/' + currentPath + '/' + file.name : file.name;
                const isActive = currentFile === filePath;
                html += `
                    <div class="file-item ${isActive ? 'active' : ''}" onclick="loadFile('${filePath}')">
                        <div class="file-name">${file.name}</div>
                        <div class="file-time">${new Date(file.modified).toLocaleString()}</div>
                    </div>
                `;
            });

            fileList.innerHTML = html;
        }

        function navigateTo(path) {
            currentPath = path;
            loadFiles();
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!currentPath) {
                breadcrumb.innerHTML = '<span class="breadcrumb-current">ğŸ“ outputs</span>';
                return;
            }

            const parts = currentPath.split('/').filter(p => p);
            let html = '<span class="breadcrumb-item" onclick="navigateTo(\'\')">ğŸ“ outputs</span>';

            let accumulated = '';
            parts.forEach((part, idx) => {
                html += '<span class="breadcrumb-separator">/</span>';
                accumulated += (accumulated ? '/' : '') + part;
                if (idx === parts.length - 1) {
                    html += `<span class="breadcrumb-current">${part}</span>`;
                } else {
                    html += `<span class="breadcrumb-item" onclick="navigateTo('${accumulated}')">${part}</span>`;
                }
            });

            breadcrumb.innerHTML = html;
        }

        // =========================================
        // íŒŒì¼ ë¡œë“œ/ì €ì¥ (ê³µí†µ ì½”ë“œ)
        // =========================================
        async function loadFile(filename) {
            try {
                const response = await fetch(`/api/editor/file/${encodeURIComponent(filename)}`);
                const data = await response.json();

                if (data.success) {
                    currentFile = filename;
                    originalContent = data.content;
                    document.getElementById('htmlEditor').value = data.content;
                    document.getElementById('currentFileInfo').textContent = filename.split('/').pop();
                    document.getElementById('statusText').textContent = `${filename} ë¡œë“œë¨`;
                    updatePreview();
                    updateCharCount();
                    loadFiles();
                } else {
                    showNotification('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜', 'error');
            }
        }

        async function saveFile() {
            if (!currentFile) {
                showNotification('ì €ì¥í•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const content = document.getElementById('htmlEditor').value;

            try {
                const response = await fetch('/api/editor/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename: currentFile, content })
                });

                const data = await response.json();
                if (data.success) {
                    originalContent = content;
                    showNotification('ì €ì¥ ì™„ë£Œ!', 'success');
                    document.getElementById('statusText').textContent = 'ì €ì¥ë¨';
                } else {
                    showNotification('ì €ì¥ ì‹¤íŒ¨: ' + data.detail, 'error');
                }
            } catch (error) {
                showNotification('ì €ì¥ ì˜¤ë¥˜', 'error');
            }
        }

        function downloadFile() {
            if (!currentFile) {
                showNotification('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const content = document.getElementById('htmlEditor').value;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile.split('/').pop();
            a.click();
            URL.revokeObjectURL(url);
            showNotification('ë‹¤ìš´ë¡œë“œ ì‹œì‘!', 'success');
        }

        async function downloadWithImages() {
            if (!currentFile) {
                showNotification('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            try {
                showNotification('ZIP ìƒì„± ì¤‘...', 'info');
                const response = await fetch(`/api/editor/download-zip/${encodeURIComponent(currentFile)}`);

                if (!response.ok) throw new Error('ZIP ìƒì„± ì‹¤íŒ¨');

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = currentFile.split('/').pop().replace('.html', '.zip');
                a.click();
                URL.revokeObjectURL(url);
                showNotification('ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success');
            } catch (error) {
                showNotification('ZIP ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // =========================================
        // ì—ë””í„° ê¸°ëŠ¥ (ê³µí†µ ì½”ë“œ)
        // =========================================
        function setupEditorEvents() {
            const editor = document.getElementById('htmlEditor');

            editor.addEventListener('input', () => {
                updateCharCount();
                schedulePreviewUpdate();
            });

            editor.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 's') {
                        e.preventDefault();
                        saveFile();
                    }
                }
            });
        }

        function updateCharCount() {
            const count = document.getElementById('htmlEditor').value.length;
            document.getElementById('charCount').textContent = `${count.toLocaleString()}ì`;
        }

        function schedulePreviewUpdate() {
            clearTimeout(previewUpdateTimer);
            previewUpdateTimer = setTimeout(updatePreview, 300);
        }

        function updatePreview() {
            const content = document.getElementById('htmlEditor').value;
            const frame = document.getElementById('previewFrame');
            const doc = frame.contentDocument || frame.contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
        }

        function setPreviewSize(size) {
            const device = document.getElementById('previewDevice');
            device.className = 'preview-device ' + size;

            document.querySelectorAll('.preview-size-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(size === 'desktop' ? 'ğŸ–¥ï¸' : size === 'mobile' ? 'ğŸ“±' : 'ğŸ“Ÿ')) {
                    btn.classList.add('active');
                }
            });
        }

        // =========================================
        // ë¦¬ì‚¬ì´ì € (ê³µí†µ ì½”ë“œ)
        // =========================================
        function setupResizer() {
            const resizer = document.getElementById('resizer');
            const editorPane = document.getElementById('editorPane');
            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const containerRect = document.querySelector('.split-view').getBoundingClientRect();
                const newWidth = e.clientX - containerRect.left;
                editorPane.style.flex = 'none';
                editorPane.style.width = Math.max(300, Math.min(newWidth, containerRect.width - 300)) + 'px';
            });

            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = '';
            });
        }

        // =========================================
        // ì‚¬ì´ë“œë°” íƒ­ (ê³µí†µ ì½”ë“œ)
        // =========================================
        function switchSidebarTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.sidebar-tab[onclick="switchSidebarTab('${tab}')"]`).classList.add('active');

            document.getElementById('filesPanel').style.display = tab === 'files' ? 'flex' : 'none';
            document.getElementById('toolsPanel').classList.toggle('active', tab === 'tools');
        }

        function toggleToolSection(header) {
            const section = header.parentElement;
            const isOpen = section.classList.contains('open');

            document.querySelectorAll('.tool-section').forEach(s => s.classList.remove('open'));

            if (!isOpen) {
                section.classList.add('open');
            }

            document.querySelectorAll('.tool-section-header span:last-child').forEach(icon => {
                icon.textContent = icon.closest('.tool-section').classList.contains('open') ? 'â–¼' : 'â–¶';
            });
        }

        // =========================================
        // ì•Œë¦¼ (ê³µí†µ ì½”ë“œ)
        // =========================================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.innerHTML = `<span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span> ${message}`;
            notification.className = `notification show ${type}`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // =========================================
        // ê³µí†µ í…ìŠ¤íŠ¸ í¬ë§·
        // =========================================
        function formatText(type) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);

            let wrapper;
            switch (type) {
                case 'bold': wrapper = ['<strong>', '</strong>']; break;
                case 'italic': wrapper = ['<em>', '</em>']; break;
                case 'underline': wrapper = ['<u>', '</u>']; break;
            }

            const newText = wrapper[0] + selectedText + wrapper[1];
            editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
            editor.focus();
            updatePreview();
        }

        function insertElement(tag) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const selectedText = editor.value.substring(start, editor.selectionEnd) || 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”';

            const newText = `<${tag}>${selectedText}</${tag}>\n`;
            editor.value = editor.value.substring(0, start) + newText + editor.value.substring(editor.selectionEnd);
            editor.focus();
            updatePreview();
        }

        function beautifyHTML() {
            const editor = document.getElementById('htmlEditor');
            let html = editor.value;
            html = html.replace(/></g, '>\n<');
            html = html.replace(/\n\s*\n/g, '\n');
            editor.value = html;
            updatePreview();
            showNotification('ì½”ë“œ ì •ë¦¬ ì™„ë£Œ', 'success');
        }

        function findReplace() {
            const find = prompt('ì°¾ì„ í…ìŠ¤íŠ¸:');
            if (!find) return;

            const replace = prompt('ë°”ê¿€ í…ìŠ¤íŠ¸:');
            if (replace === null) return;

            const editor = document.getElementById('htmlEditor');
            const count = (editor.value.match(new RegExp(find, 'g')) || []).length;
            editor.value = editor.value.split(find).join(replace);
            updatePreview();
            showNotification(`${count}ê°œ í•­ëª© êµì²´ë¨`, 'success');
        }

        // =========================================
        // í›„ë³´ì ì¹´ë“œ ëª¨ë‹¬
        // =========================================
        function openCandidateModal() {
            document.getElementById('candidateModal').classList.add('active');
            updateCandidatePreview();
        }

        function closeCandidateModal() {
            document.getElementById('candidateModal').classList.remove('active');
        }

        function selectParty(element, name, color) {
            document.querySelectorAll('.party-option').forEach(p => p.classList.remove('selected'));
            element.classList.add('selected');
            selectedParty = { name, color };
            updateCandidatePreview();
        }

        function updateCandidatePreview() {
            const name = document.getElementById('candidateName').value || 'í›„ë³´ì ì´ë¦„';
            const slogan = document.getElementById('candidateSlogan').value || 'ìŠ¬ë¡œê±´ì„ ì…ë ¥í•˜ì„¸ìš”';
            const photo = document.getElementById('candidatePhoto').value;

            document.getElementById('previewName').textContent = name;
            document.getElementById('previewSlogan').textContent = slogan;
            document.getElementById('previewParty').textContent = selectedParty.name;
            document.getElementById('previewParty').style.background = selectedParty.color;

            if (photo) {
                document.getElementById('previewPhoto').innerHTML = `<img src="${photo}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`;
            } else {
                document.getElementById('previewPhoto').innerHTML = 'ğŸ‘¤';
            }
        }

        // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        document.addEventListener('input', (e) => {
            if (['candidateName', 'candidateSlogan', 'candidatePhoto'].includes(e.target.id)) {
                updateCandidatePreview();
            }
        });

        function insertCandidateCard() {
            const number = document.getElementById('candidateNumber').value || '1';
            const name = document.getElementById('candidateName').value || 'í›„ë³´ì';
            const district = document.getElementById('candidateDistrict').value || '';
            const slogan = document.getElementById('candidateSlogan').value || '';
            const photo = document.getElementById('candidatePhoto').value;

            const html = `
<div class="candidate-card" style="background: linear-gradient(135deg, ${selectedParty.color}15 0%, #fff 100%); padding: 25px; border-radius: 16px; margin: 20px 0; border: 2px solid ${selectedParty.color};">
    <div style="display: flex; gap: 20px; align-items: center;">
        <div style="width: 120px; height: 150px; background: ${photo ? 'none' : '#f3f4f6'}; border-radius: 12px; overflow: hidden; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 3em; color: #9ca3af;">
            ${photo ? `<img src="${photo}" style="width: 100%; height: 100%; object-fit: cover;">` : 'ğŸ‘¤'}
        </div>
        <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="display: inline-flex; width: 40px; height: 40px; background: ${selectedParty.color}; color: white; border-radius: 50%; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2em;">${number}</span>
                <span style="background: ${selectedParty.color}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600;">${selectedParty.name}</span>
            </div>
            <div style="font-size: 2em; font-weight: 800; color: #1f2937; margin-bottom: 4px;">${name}</div>
            ${district ? `<div style="color: #6b7280; font-size: 0.9em; margin-bottom: 8px;">ğŸ“ ${district}</div>` : ''}
            ${slogan ? `<div style="color: ${selectedParty.color}; font-size: 1.1em; font-weight: 600; font-style: italic;">"${slogan}"</div>` : ''}
        </div>
    </div>
</div>`;

            insertAtCursor(html);
            closeCandidateModal();
            showNotification('í›„ë³´ì ì¹´ë“œ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // ê³µì•½ ëª¨ë‹¬
        // =========================================
        function openPledgeModal() {
            document.getElementById('pledgeModal').classList.add('active');
            updatePledgeInputs();
        }

        function closePledgeModal() {
            document.getElementById('pledgeModal').classList.remove('active');
        }

        function updatePledgeInputs() {
            const count = parseInt(document.getElementById('pledgeCount').value);
            const container = document.getElementById('pledgeInputs');

            let html = '';
            for (let i = 1; i <= count; i++) {
                html += `
                    <div class="form-group">
                        <label class="form-label">ê³µì•½ ${i}</label>
                        <input type="text" class="form-input pledge-input" id="pledge${i}" placeholder="ì˜ˆ: ì²­ë…„ ì¼ìë¦¬ 10ë§Œê°œ ì°½ì¶œ">
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function insertPledges() {
            const count = parseInt(document.getElementById('pledgeCount').value);
            const style = document.getElementById('pledgeStyle').value;
            const pledges = [];

            for (let i = 1; i <= count; i++) {
                const input = document.getElementById(`pledge${i}`);
                if (input && input.value.trim()) {
                    pledges.push(input.value.trim());
                }
            }

            if (pledges.length === 0) {
                showNotification('ìµœì†Œ í•˜ë‚˜ì˜ ê³µì•½ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            let html = '<div class="pledges-section" style="margin: 25px 0;">\n';
            html += '    <h2 style="text-align: center; color: #1e3a8a; margin-bottom: 20px;">ğŸ¯ í•µì‹¬ ê³µì•½</h2>\n';

            if (style === 'cards') {
                pledges.forEach((pledge, i) => {
                    html += `
    <div style="background: white; border-radius: 12px; padding: 16px 20px; margin-bottom: 12px; border-left: 5px solid #1e3a8a; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div style="display: flex; align-items: center; gap: 12px;">
            <span style="display: inline-flex; width: 32px; height: 32px; background: #1e3a8a; color: white; border-radius: 50%; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">${i + 1}</span>
            <span style="font-size: 1.05em; color: #1f2937; font-weight: 500;">${pledge}</span>
        </div>
    </div>\n`;
                });
            } else if (style === 'list') {
                html += '    <ul style="list-style: none; padding: 0;">\n';
                pledges.forEach((pledge, i) => {
                    html += `        <li style="padding: 12px 0; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 10px;">
            <span style="background: #1e3a8a; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9em;">${i + 1}</span>
            ${pledge}
        </li>\n`;
                });
                html += '    </ul>\n';
            } else {
                html += '    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">\n';
                pledges.forEach((pledge, i) => {
                    html += `        <div style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 2em; font-weight: 800; margin-bottom: 8px;">${i + 1}</div>
            <div style="font-size: 0.95em;">${pledge}</div>
        </div>\n`;
                });
                html += '    </div>\n';
            }

            html += '</div>';

            insertAtCursor(html);
            closePledgeModal();
            showNotification('ê³µì•½ ì„¹ì…˜ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // ê²½ë ¥ ëª¨ë‹¬
        // =========================================
        function openCareerModal() {
            document.getElementById('careerModal').classList.add('active');
        }

        function closeCareerModal() {
            document.getElementById('careerModal').classList.remove('active');
        }

        function insertCareer() {
            const careerText = document.getElementById('careerList').value.trim();
            const awardText = document.getElementById('awardList').value.trim();
            const style = document.getElementById('careerStyle').value;

            const careers = careerText.split('\n').filter(c => c.trim());
            const awards = awardText.split('\n').filter(a => a.trim());

            if (careers.length === 0) {
                showNotification('ê²½ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            let html = '<div class="career-section" style="margin: 25px 0;">\n';
            html += '    <h2 style="color: #1e3a8a; margin-bottom: 20px;">ğŸ’¼ ì£¼ìš” ê²½ë ¥</h2>\n';

            if (style === 'timeline') {
                html += '    <div style="border-left: 3px solid #1e3a8a; padding-left: 20px; margin-left: 10px;">\n';
                careers.forEach(career => {
                    html += `        <div style="position: relative; padding-bottom: 15px;">
            <div style="position: absolute; left: -28px; width: 12px; height: 12px; background: #1e3a8a; border-radius: 50%;"></div>
            <div style="background: #f8fafc; padding: 12px 16px; border-radius: 8px;">${career}</div>
        </div>\n`;
                });
                html += '    </div>\n';
            } else {
                html += '    <ul style="list-style: none; padding: 0;">\n';
                careers.forEach(career => {
                    html += `        <li style="padding: 10px 0; border-bottom: 1px solid #e5e7eb;">âœ“ ${career}</li>\n`;
                });
                html += '    </ul>\n';
            }

            if (awards.length > 0) {
                html += '    <h3 style="color: #dc2626; margin: 25px 0 15px;">ğŸ† ì£¼ìš” ìˆ˜ìƒ</h3>\n';
                html += '    <ul style="list-style: none; padding: 0;">\n';
                awards.forEach(award => {
                    html += `        <li style="padding: 8px 0; color: #dc2626;">ğŸ… ${award}</li>\n`;
                });
                html += '    </ul>\n';
            }

            html += '</div>';

            insertAtCursor(html);
            closeCareerModal();
            showNotification('ê²½ë ¥ ì„¹ì…˜ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // ì§€ì—­êµ¬ ëª¨ë‹¬
        // =========================================
        function openRegionModal() {
            document.getElementById('regionModal').classList.add('active');
        }

        function closeRegionModal() {
            document.getElementById('regionModal').classList.remove('active');
        }

        function updateDistricts() {
            const province = document.getElementById('regionProvince').value;
            const grid = document.getElementById('districtGrid');

            if (!province || !districtData[province]) {
                grid.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray); grid-column: 1/-1;">ì‹œ/ë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</div>';
                return;
            }

            const districts = districtData[province];
            grid.innerHTML = districts.map(d => `
                <button class="region-btn" onclick="selectDistrict(this, '${d}')">${d}</button>
            `).join('');
        }

        function selectDistrict(btn, district) {
            document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedDistrict = district;
        }

        function insertRegionInfo() {
            const province = document.getElementById('regionProvince').value;
            const section = document.getElementById('regionSection').value;

            if (!province || !selectedDistrict) {
                showNotification('ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const fullRegion = `${province} ${selectedDistrict}${section ? ' ' + section : ''}`;

            const html = `
<div class="region-info" style="background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%); padding: 20px; border-radius: 12px; margin: 20px 0; text-align: center; border: 2px solid #3b82f6;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“</div>
    <div style="font-size: 0.9em; color: #3b82f6; margin-bottom: 5px;">ì„ ê±°êµ¬</div>
    <div style="font-size: 1.4em; font-weight: 700; color: #1e3a8a;">${fullRegion}</div>
</div>`;

            insertAtCursor(html);
            closeRegionModal();
            showNotification('ì§€ì—­êµ¬ ì •ë³´ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // í”„ë¡œí•„ ëª¨ë‹¬
        // =========================================
        function openProfileModal() {
            document.getElementById('profileModal').classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function insertProfile() {
            const education = document.getElementById('profileEducation').value.trim().split('\n').filter(e => e.trim());
            const youtube = document.getElementById('profileYoutube').value.trim();
            const instagram = document.getElementById('profileInstagram').value.trim();
            const facebook = document.getElementById('profileFacebook').value.trim();
            const blog = document.getElementById('profileBlog').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            const email = document.getElementById('profileEmail').value.trim();

            let html = '<div class="profile-card" style="background: #f8fafc; padding: 25px; border-radius: 16px; margin: 20px 0;">\n';

            if (education.length > 0) {
                html += '    <div style="margin-bottom: 20px;">\n';
                html += '        <h3 style="color: #1e3a8a; margin-bottom: 12px;">ğŸ“ í•™ë ¥</h3>\n';
                html += '        <ul style="list-style: none; padding: 0; margin: 0;">\n';
                education.forEach(edu => {
                    html += `            <li style="padding: 6px 0; color: #374151;">â€¢ ${edu}</li>\n`;
                });
                html += '        </ul>\n';
                html += '    </div>\n';
            }

            const snsLinks = [];
            if (youtube) snsLinks.push({ icon: 'â–¶', name: 'YouTube', url: youtube, bg: '#FF0000' });
            if (instagram) snsLinks.push({ icon: 'ğŸ“·', name: 'Instagram', url: instagram, bg: '#E1306C' });
            if (facebook) snsLinks.push({ icon: 'f', name: 'Facebook', url: facebook, bg: '#1877F2' });
            if (blog) snsLinks.push({ icon: 'ğŸŒ', name: 'í™ˆí˜ì´ì§€', url: blog, bg: '#10B981' });

            if (snsLinks.length > 0) {
                html += '    <div style="margin-bottom: 20px;">\n';
                html += '        <h3 style="color: #1e3a8a; margin-bottom: 12px;">ğŸ“± SNS</h3>\n';
                html += '        <div style="display: flex; gap: 10px; flex-wrap: wrap;">\n';
                snsLinks.forEach(link => {
                    html += `            <a href="${link.url}" target="_blank" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: ${link.bg}; color: white; text-decoration: none; border-radius: 8px; font-size: 0.9em;">${link.icon} ${link.name}</a>\n`;
                });
                html += '        </div>\n';
                html += '    </div>\n';
            }

            if (phone || email) {
                html += '    <div>\n';
                html += '        <h3 style="color: #1e3a8a; margin-bottom: 12px;">ğŸ“ ì—°ë½ì²˜</h3>\n';
                if (phone) html += `        <p style="margin: 6px 0;"><a href="tel:${phone}" style="color: #1e3a8a; text-decoration: none;">â˜ï¸ ${phone}</a></p>\n`;
                if (email) html += `        <p style="margin: 6px 0;"><a href="mailto:${email}" style="color: #1e3a8a; text-decoration: none;">âœ‰ï¸ ${email}</a></p>\n`;
                html += '    </div>\n';
            }

            html += '</div>';

            insertAtCursor(html);
            closeProfileModal();
            showNotification('í”„ë¡œí•„ ì¹´ë“œ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // ê¸°íƒ€ ëª¨ë‹¬ (TODO)
        // =========================================
        function openDeclarationModal() {
            showNotification('ì¶œì‚¬í‘œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        function openDetailedPledgeModal() {
            showNotification('ìƒì„¸ ê³µì•½ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        function openDistrictModal() {
            showNotification('ì„ ê±°êµ¬ ì •ë³´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        function openSnsModal() {
            showNotification('SNS ë§í¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        function openContactModal() {
            showNotification('ì—°ë½ì²˜ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        // =========================================
        // AI ì±„íŒ…
        // =========================================
        function toggleAiChat() {
            const panel = document.getElementById('aiChatPanel');
            const fab = document.getElementById('aiFab');
            panel.classList.toggle('active');
            fab.classList.toggle('hidden', panel.classList.contains('active'));
        }

        function handleAiInputKeypress(e) {
            if (e.key === 'Enter') {
                sendAiMessage();
            }
        }

        async function sendAiMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById('aiChatMessages');

            messagesDiv.innerHTML += `<div class="ai-message user">${message}</div>`;
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            messagesDiv.innerHTML += `<div class="ai-message assistant">ìš”ì²­ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>`;

            try {
                const htmlContent = document.getElementById('htmlEditor').value;
                const response = await fetch('/api/ai/edit-html', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        html_content: htmlContent,
                        instruction: message,
                        content_type: 'election'
                    })
                });

                const data = await response.json();
                const lastMsg = messagesDiv.lastElementChild;

                if (data.success) {
                    document.getElementById('htmlEditor').value = data.html;
                    updatePreview();
                    lastMsg.textContent = 'ìˆ˜ì •ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else {
                    lastMsg.textContent = 'ì£„ì†¡í•©ë‹ˆë‹¤. ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (error) {
                const lastMsg = messagesDiv.lastElementChild;
                lastMsg.textContent = 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // =========================================
        // ìœ í‹¸ë¦¬í‹°
        // =========================================
        function insertAtCursor(text) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;

            editor.value = editor.value.substring(0, start) + text + editor.value.substring(end);
            editor.selectionStart = editor.selectionEnd = start + text.length;
            editor.focus();
            updatePreview();
            updateCharCount();
        }
    </script>
</body>
</html>
