<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë³´ ì „ë¬¸ í¸ì§‘ê¸° - StudySnap</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            /* ì£¼ë³´ í…Œë§ˆ - ë”°ëœ»í•œ ë¸Œë¼ìš´ ê³„ì—´ */
            --primary: #8B4513;
            --primary-dark: #5D3A1A;
            --primary-light: #D2B48C;
            --accent: #C5A572;
            --accent-light: #F5F0E8;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --text-dark: #2C1810;
            --text-gray: #6B7280;
            --bg-gray: #F9F7F4;
            --border: #E5E0D8;
            --white: #FFFFFF;
            --gold: #D4AF37;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-gray);
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 1.2em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-badge {
            background: var(--gold);
            color: var(--primary-dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .file-info {
            font-size: 0.85em;
            opacity: 0.9;
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 6px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.3);
        }

        .nav-link.active {
            background: var(--gold);
            color: var(--primary-dark);
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.5);
            color: white;
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-primary {
            background: var(--success);
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-gold {
            background: var(--gold);
            color: var(--primary-dark);
        }

        .btn-gold:hover {
            background: #C9A227;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            height: calc(100vh - 52px);
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            background: var(--white);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: var(--bg-gray);
            border: none;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            color: var(--text-gray);
            transition: all 0.2s;
        }

        .sidebar-tab.active {
            background: var(--white);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .sidebar-tab:hover:not(.active) {
            background: var(--accent-light);
        }

        /* íŒŒì¼ íƒìƒ‰ê¸° */
        .file-explorer {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .breadcrumb {
            padding: 8px 12px;
            background: var(--accent-light);
            border-bottom: 1px solid var(--border);
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            color: var(--info);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .breadcrumb-item:hover {
            background: #DBEAFE;
        }

        .breadcrumb-separator {
            color: #9CA3AF;
        }

        .breadcrumb-current {
            color: var(--text-dark);
            font-weight: 600;
        }

        .file-list {
            flex: 1;
            overflow-y: auto;
        }

        .folder-item, .file-item {
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .folder-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #FEF7E8;
        }

        .folder-item:hover {
            background: #FEF3C7;
        }

        .folder-name {
            font-size: 0.85em;
            color: #92400E;
            font-weight: 500;
        }

        .file-item:hover {
            background: var(--bg-gray);
        }

        .file-item.active {
            background: var(--accent-light);
            border-left: 3px solid var(--primary);
        }

        .file-name {
            font-size: 0.85em;
            color: var(--text-dark);
            margin-bottom: 2px;
            word-break: break-all;
        }

        .file-time {
            font-size: 0.7em;
            color: var(--text-gray);
        }

        /* ì£¼ë³´ ì „ìš© ë„êµ¬ íŒ¨ë„ */
        .tools-panel {
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .tools-panel.active {
            display: flex;
            flex: 1;
        }

        .tool-section {
            border-bottom: 1px solid var(--border);
        }

        .tool-section-header {
            padding: 10px 14px;
            background: var(--bg-gray);
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .tool-section-header:hover {
            background: var(--accent-light);
        }

        .tool-section-content {
            padding: 10px;
            display: none;
        }

        .tool-section.open .tool-section-content {
            display: block;
        }

        .tool-btn {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-btn:hover {
            background: var(--accent-light);
            border-color: var(--primary);
        }

        .tool-btn-icon {
            font-size: 1.3em;
        }

        .tool-btn-text {
            flex: 1;
        }

        .tool-btn-title {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .tool-btn-desc {
            font-size: 0.75em;
            color: var(--text-gray);
        }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .content-area {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ê³µí†µ + ì£¼ë³´ ì „ìš© íˆ´ë°” */
        .toolbar {
            display: flex;
            padding: 8px 12px;
            background: var(--white);
            border-bottom: 1px solid var(--border);
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            padding-right: 10px;
            border-right: 1px solid var(--border);
            margin-right: 6px;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-group-label {
            font-size: 0.7em;
            color: var(--text-gray);
            padding: 0 8px;
            align-self: center;
        }

        .toolbar-btn {
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar-btn:hover {
            background: var(--bg-gray);
        }

        .toolbar-btn.church-tool {
            background: var(--accent-light);
            border-color: var(--accent);
        }

        .toolbar-btn.church-tool:hover {
            background: var(--primary-light);
        }

        /* ë¶„í•  ë·° */
        .split-view {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            border-right: 1px solid var(--border);
        }

        .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }

        .pane-header {
            padding: 8px 12px;
            background: var(--bg-gray);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pane-title {
            font-weight: 600;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .resizer {
            width: 6px;
            background: var(--border);
            cursor: col-resize;
            transition: background 0.2s;
        }

        .resizer:hover {
            background: var(--primary);
        }

        /* ì½”ë“œ ì—ë””í„° */
        .editor-content {
            flex: 1;
            padding: 10px;
            overflow: hidden;
        }

        #htmlEditor {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: none;
            background: #FEFEFE;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
            background: #E5E0D8;
            overflow: auto;
        }

        .preview-device {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: all 0.3s;
        }

        .preview-device.desktop {
            width: 100%;
            height: 100%;
        }

        .preview-device.tablet {
            width: 768px;
            height: 100%;
            border-radius: 12px;
        }

        .preview-device.mobile {
            width: 375px;
            height: 100%;
            border-radius: 24px;
            border: 10px solid #333;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-size-btns {
            display: flex;
            gap: 4px;
        }

        .preview-size-btn {
            padding: 4px 8px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75em;
        }

        .preview-size-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ìƒíƒœë°” */
        .status-bar {
            padding: 6px 12px;
            background: var(--bg-gray);
            border-top: 1px solid var(--border);
            font-size: 0.75em;
            color: var(--text-gray);
            display: flex;
            justify-content: space-between;
        }

        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 60px;
            right: 20px;
            padding: 12px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: none;
            z-index: 9999;
            animation: slideIn 0.3s;
        }

        .notification.show {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.success { border-left: 4px solid var(--success); }
        .notification.error { border-left: 4px solid var(--danger); }
        .notification.info { border-left: 4px solid var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-gray);
        }

        .modal-close:hover {
            color: var(--text-dark);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ì„±ê²½ êµ¬ì ˆ ì„ íƒê¸° */
        .bible-selector {
            display: grid;
            grid-template-columns: 1fr 80px 80px;
            gap: 10px;
        }

        /* ì°¬ì†¡ ê²€ìƒ‰ */
        .hymn-search-result {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-top: 10px;
        }

        .hymn-item {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .hymn-item:hover {
            background: var(--accent-light);
        }

        .hymn-item:last-child {
            border-bottom: none;
        }

        .hymn-number {
            font-weight: 700;
            color: var(--primary);
            margin-right: 8px;
        }

        /* SNS ë§í¬ ì•„ì´í…œ */
        .sns-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-gray);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .sns-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .sns-icon.youtube { background: #FF0000; color: white; }
        .sns-icon.instagram { background: linear-gradient(45deg, #833AB4, #FD1D1D, #FCAF45); color: white; }
        .sns-icon.facebook { background: #1877F2; color: white; }
        .sns-icon.kakao { background: #FEE500; color: #3C1E1E; }
        .sns-icon.naver { background: #03C75A; color: white; }

        /* AI ì±„íŒ… ì˜¤ë²„ë ˆì´ */
        .ai-chat-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 9998;
        }

        .ai-chat-overlay.active {
            display: flex;
        }

        .ai-chat-header {
            padding: 14px 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-message {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .ai-message.user {
            background: var(--accent-light);
            align-self: flex-end;
        }

        .ai-message.assistant {
            background: var(--bg-gray);
            align-self: flex-start;
        }

        .ai-chat-input {
            padding: 12px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .ai-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 9997;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .ai-fab:hover {
            transform: scale(1.1);
        }

        .ai-fab.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-left">
            <div class="logo">
                <span>ğŸ•Šï¸</span>
                <span>ì†ì•ˆì˜ ì£¼ë³´</span>
                <span class="category-badge">Church</span>
            </div>
            <div class="header-nav">
                <a href="/static/explorer.html" class="nav-link">ğŸ—‚ï¸ íƒìƒ‰ê¸°</a>
                <a href="/static/church-editor.html" class="nav-link active">ğŸ•Šï¸ ì£¼ë³´</a>
                <a href="/static/election-editor.html" class="nav-link">ğŸ—³ï¸ ì„ ê±°</a>
                <a href="/static/editor.html" class="nav-link">ğŸ“ ì¼ë°˜</a>
            </div>
            <div class="file-info" id="currentFileInfo">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline" onclick="loadFiles()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn btn-gold" onclick="saveFile()">ğŸ’¾ ì €ì¥</button>
            <button class="btn btn-outline" onclick="downloadFile()">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ</button>
            <button class="btn btn-primary" onclick="downloadWithImages()">ğŸ“¦ ZIP</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" onclick="switchSidebarTab('files')">ğŸ“ íŒŒì¼</button>
                <button class="sidebar-tab" onclick="switchSidebarTab('tools')">ğŸ› ï¸ ë„êµ¬</button>
            </div>

            <!-- íŒŒì¼ íƒìƒ‰ê¸° -->
            <div class="file-explorer" id="filesPanel">
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-current">ğŸ“ Church</span>
                </div>
                <div class="file-list" id="fileList">
                    <div style="padding: 20px; text-align: center; color: var(--text-gray);">
                        ğŸ“‚ íŒŒì¼ ë¡œë”© ì¤‘...
                    </div>
                </div>
            </div>

            <!-- ì£¼ë³´ ì „ìš© ë„êµ¬ íŒ¨ë„ -->
            <div class="tools-panel" id="toolsPanel">
                <div class="tool-section open">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ“–</span> ì„±ê²½/ì°¬ì†¡
                        <span style="margin-left: auto;">â–¼</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openBibleModal()">
                            <span class="tool-btn-icon">ğŸ“–</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì„±ê²½ êµ¬ì ˆ ì‚½ì…</div>
                                <div class="tool-btn-desc">ì„±ê²½ êµ¬ì ˆ ë§í¬ ìƒì„±</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openHymnModal()">
                            <span class="tool-btn-icon">ğŸµ</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì°¬ì†¡ê°€ ë§í¬</div>
                                <div class="tool-btn-desc">ì°¬ì†¡ê°€ YouTube ì—°ê²°</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openHymnSheetModal()">
                            <span class="tool-btn-icon">ğŸ¼</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì°¬ì†¡ê°€ ì•…ë³´</div>
                                <div class="tool-btn-desc">ì•…ë³´ í¬í•¨ ë§í¬ ìƒì„±</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ¤</span> ì„¤êµ/ë¯¸ë””ì–´
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openSermonModal()">
                            <span class="tool-btn-icon">ğŸ¤</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì„¤êµ ì˜¤ë””ì˜¤</div>
                                <div class="tool-btn-desc">ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì‚½ì…</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openVideoModal()">
                            <span class="tool-btn-icon">ğŸ“¹</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì„¤êµ ì˜ìƒ</div>
                                <div class="tool-btn-desc">YouTube ì˜ìƒ ì‚½ì…</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ’°</span> í—Œê¸ˆ/ê²°ì œ
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openOfferingModal()">
                            <span class="tool-btn-icon">ğŸ’³</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ëª¨ë°”ì¼ í—Œê¸ˆ</div>
                                <div class="tool-btn-desc">PG ê²°ì œ ì—°ë™</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openAccountModal()">
                            <span class="tool-btn-icon">ğŸ¦</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ê³„ì¢Œ ì •ë³´</div>
                                <div class="tool-btn-desc">ë³µì‚¬ ê°€ëŠ¥í•œ ê³„ì¢Œë²ˆí˜¸</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="tool-section-header" onclick="toggleToolSection(this)">
                        <span>ğŸ”—</span> SNS/ë§í¬
                        <span style="margin-left: auto;">â–¶</span>
                    </div>
                    <div class="tool-section-content">
                        <button class="tool-btn" onclick="openSnsModal()">
                            <span class="tool-btn-icon">ğŸ“±</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">SNS ë§í¬ ë“±ë¡</div>
                                <div class="tool-btn-desc">YouTube, ì¸ìŠ¤íƒ€ ë“±</div>
                            </div>
                        </button>
                        <button class="tool-btn" onclick="openContactModal()">
                            <span class="tool-btn-icon">ğŸ“</span>
                            <div class="tool-btn-text">
                                <div class="tool-btn-title">ì—°ë½ì²˜ ì¹´ë“œ</div>
                                <div class="tool-btn-desc">ì „í™”/ì´ë©”ì¼ ë§í¬</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì»¨í…ì¸  ì˜ì—­ -->
        <div class="content-area">
            <!-- ê³µí†µ + ì£¼ë³´ ì „ìš© íˆ´ë°” -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <span class="toolbar-group-label">ê³µí†µ</span>
                    <button class="toolbar-btn" onclick="formatText('bold')" title="êµµê²Œ"><b>B</b></button>
                    <button class="toolbar-btn" onclick="formatText('italic')" title="ê¸°ìš¸ì„"><i>I</i></button>
                    <button class="toolbar-btn" onclick="formatText('underline')" title="ë°‘ì¤„"><u>U</u></button>
                    <button class="toolbar-btn" onclick="insertElement('h1')">H1</button>
                    <button class="toolbar-btn" onclick="insertElement('h2')">H2</button>
                    <button class="toolbar-btn" onclick="insertElement('p')">P</button>
                </div>
                <div class="toolbar-group">
                    <span class="toolbar-group-label">ì£¼ë³´ì „ìš©</span>
                    <button class="toolbar-btn church-tool" onclick="openBibleModal()" title="ì„±ê²½ êµ¬ì ˆ">ğŸ“–</button>
                    <button class="toolbar-btn church-tool" onclick="openHymnModal()" title="ì°¬ì†¡ê°€">ğŸµ</button>
                    <button class="toolbar-btn church-tool" onclick="openSermonModal()" title="ì„¤êµ">ğŸ¤</button>
                    <button class="toolbar-btn church-tool" onclick="openOfferingModal()" title="í—Œê¸ˆ">ğŸ’³</button>
                    <button class="toolbar-btn church-tool" onclick="openSnsModal()" title="SNS">ğŸ“±</button>
                </div>
                <div class="toolbar-group">
                    <span class="toolbar-group-label">í¸ì§‘</span>
                    <button class="toolbar-btn" onclick="beautifyHTML()">ğŸ§¹ ì½”ë“œì •ë¦¬</button>
                    <button class="toolbar-btn" onclick="findReplace()">ğŸ” ì°¾ê¸°</button>
                </div>
            </div>

            <!-- ë¶„í•  ë·° -->
            <div class="split-view">
                <div class="editor-pane" id="editorPane">
                    <div class="pane-header">
                        <span class="pane-title">âœï¸ HTML í¸ì§‘</span>
                        <span id="charCount" style="font-size: 0.8em; color: var(--text-gray);">0ì</span>
                    </div>
                    <div class="editor-content">
                        <textarea id="htmlEditor" placeholder="HTML íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
                    </div>
                </div>

                <div class="resizer" id="resizer"></div>

                <div class="preview-pane" id="previewPane">
                    <div class="pane-header">
                        <span class="pane-title">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</span>
                        <div class="preview-size-btns">
                            <button class="preview-size-btn" onclick="setPreviewSize('desktop')">ğŸ–¥ï¸</button>
                            <button class="preview-size-btn active" onclick="setPreviewSize('mobile')">ğŸ“±</button>
                            <button class="preview-size-btn" onclick="setPreviewSize('tablet')">ğŸ“Ÿ</button>
                        </div>
                    </div>
                    <div class="preview-wrapper">
                        <div class="preview-device mobile" id="previewDevice">
                            <iframe id="previewFrame" class="preview-frame"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìƒíƒœë°” -->
            <div class="status-bar">
                <span id="statusText">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                <span>ì£¼ë³´ ì „ë¬¸ í¸ì§‘ê¸° v1.0</span>
            </div>
        </div>
    </div>

    <!-- AI ì±„íŒ… FAB -->
    <button class="ai-fab" id="aiFab" onclick="toggleAiChat()">ğŸ¤–</button>

    <!-- AI ì±„íŒ… íŒ¨ë„ -->
    <div class="ai-chat-overlay" id="aiChatPanel">
        <div class="ai-chat-header">
            <span>ğŸ¤– AI ì£¼ë³´ ë„ìš°ë¯¸</span>
            <button class="modal-close" onclick="toggleAiChat()">&times;</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message assistant">
                ì•ˆë…•í•˜ì„¸ìš”! ì£¼ë³´ í¸ì§‘ì„ ë„ì™€ë“œë¦´ê²Œìš”. ì˜ˆë¥¼ ë“¤ì–´:
                <br>â€¢ "ì œëª© í°íŠ¸ë¥¼ í‚¤ì›Œì¤˜"
                <br>â€¢ "ì˜ˆë°° ìˆœì„œ ìŠ¤íƒ€ì¼ ë³€ê²½í•´ì¤˜"
                <br>â€¢ "ìƒ‰ìƒì„ ë” ë”°ëœ»í•˜ê²Œ ë°”ê¿”ì¤˜"
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="ìˆ˜ì • ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleAiInputKeypress(event)">
            <button class="btn btn-primary" onclick="sendAiMessage()">ì „ì†¡</button>
        </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div id="notification" class="notification"></div>

    <!-- ì„±ê²½ êµ¬ì ˆ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="bibleModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ“– ì„±ê²½ êµ¬ì ˆ ì‚½ì…</span>
                <button class="modal-close" onclick="closeBibleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ì„±ê²½ ì„ íƒ</label>
                    <div class="bible-selector">
                        <select class="form-select" id="bibleBook">
                            <option value="">ì„±ê²½ ì„ íƒ</option>
                            <optgroup label="êµ¬ì•½">
                                <option value="ì°½ì„¸ê¸°">ì°½ì„¸ê¸°</option>
                                <option value="ì¶œì• êµ½ê¸°">ì¶œì• êµ½ê¸°</option>
                                <option value="ë ˆìœ„ê¸°">ë ˆìœ„ê¸°</option>
                                <option value="ë¯¼ìˆ˜ê¸°">ë¯¼ìˆ˜ê¸°</option>
                                <option value="ì‹ ëª…ê¸°">ì‹ ëª…ê¸°</option>
                                <option value="ì‹œí¸">ì‹œí¸</option>
                                <option value="ì ì–¸">ì ì–¸</option>
                                <option value="ì „ë„ì„œ">ì „ë„ì„œ</option>
                                <option value="ì´ì‚¬ì•¼">ì´ì‚¬ì•¼</option>
                            </optgroup>
                            <optgroup label="ì‹ ì•½">
                                <option value="ë§ˆíƒœë³µìŒ">ë§ˆíƒœë³µìŒ</option>
                                <option value="ë§ˆê°€ë³µìŒ">ë§ˆê°€ë³µìŒ</option>
                                <option value="ëˆ„ê°€ë³µìŒ">ëˆ„ê°€ë³µìŒ</option>
                                <option value="ìš”í•œë³µìŒ">ìš”í•œë³µìŒ</option>
                                <option value="ì‚¬ë„í–‰ì „">ì‚¬ë„í–‰ì „</option>
                                <option value="ë¡œë§ˆì„œ">ë¡œë§ˆì„œ</option>
                                <option value="ê³ ë¦°ë„ì „ì„œ">ê³ ë¦°ë„ì „ì„œ</option>
                                <option value="ê³ ë¦°ë„í›„ì„œ">ê³ ë¦°ë„í›„ì„œ</option>
                                <option value="ìš”í•œ1ì„œ">ìš”í•œ1ì„œ</option>
                                <option value="ìš”í•œê³„ì‹œë¡">ìš”í•œê³„ì‹œë¡</option>
                            </optgroup>
                        </select>
                        <input type="number" class="form-input" id="bibleChapter" placeholder="ì¥" min="1">
                        <input type="text" class="form-input" id="bibleVerse" placeholder="ì ˆ (ì˜ˆ: 1-5)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">í‘œì‹œ ìŠ¤íƒ€ì¼</label>
                    <select class="form-select" id="bibleStyle">
                        <option value="link">ë§í¬ë§Œ (í´ë¦­ì‹œ íŒì—…)</option>
                        <option value="inline">ë³¸ë¬¸ í¬í•¨ (ì¸ë¼ì¸)</option>
                        <option value="card">ì¹´ë“œí˜• (ë°°ê²½ í¬í•¨)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¯¸ë¦¬ë³´ê¸°</label>
                    <div id="biblePreview" style="padding: 15px; background: var(--accent-light); border-radius: 8px; min-height: 60px;">
                        ì„±ê²½ êµ¬ì ˆì„ ì„ íƒí•˜ì„¸ìš”
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeBibleModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertBibleVerse()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ì°¬ì†¡ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="hymnModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸµ ì°¬ì†¡ê°€ ë§í¬ ì‚½ì…</span>
                <button class="modal-close" onclick="closeHymnModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ì°¬ì†¡ê°€ ê²€ìƒ‰</label>
                    <input type="text" class="form-input" id="hymnSearch" placeholder="ë²ˆí˜¸ ë˜ëŠ” ì œëª© ê²€ìƒ‰..." oninput="searchHymn()">
                </div>
                <div id="hymnSearchResult" class="hymn-search-result" style="display: none;"></div>
                <div class="form-group">
                    <label class="form-label">ì„ íƒëœ ì°¬ì†¡</label>
                    <div id="selectedHymn" style="padding: 12px; background: var(--accent-light); border-radius: 8px;">
                        ì°¬ì†¡ê°€ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë§í¬ ìœ í˜•</label>
                    <select class="form-select" id="hymnLinkType">
                        <option value="youtube">YouTube ì˜ìƒ</option>
                        <option value="audio">ì˜¤ë””ì˜¤ë§Œ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeHymnModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertHymnLink()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ì„¤êµ ì˜¤ë””ì˜¤ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="sermonModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ¤ ì„¤êµ ì˜¤ë””ì˜¤ ì‚½ì…</span>
                <button class="modal-close" onclick="closeSermonModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ì˜¤ë””ì˜¤ ì†ŒìŠ¤</label>
                    <select class="form-select" id="sermonSource">
                        <option value="url">ì™¸ë¶€ URL</option>
                        <option value="upload">íŒŒì¼ ì—…ë¡œë“œ</option>
                        <option value="youtube">YouTube</option>
                    </select>
                </div>
                <div class="form-group" id="sermonUrlGroup">
                    <label class="form-label">ì˜¤ë””ì˜¤ URL</label>
                    <input type="text" class="form-input" id="sermonUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">ì„¤êµ ì œëª©</label>
                    <input type="text" class="form-input" id="sermonTitle" placeholder="ì˜ˆ: 2025ë…„ 12ì›” 7ì¼ ì£¼ì¼ì„¤êµ">
                </div>
                <div class="form-group">
                    <label class="form-label">ì„¤êµì</label>
                    <input type="text" class="form-input" id="sermonSpeaker" placeholder="ì˜ˆ: í™ê¸¸ë™ ë‹´ì„ëª©ì‚¬">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sermonDownload" checked> ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í¬í•¨
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeSermonModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertSermonPlayer()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ë°”ì¼ í—Œê¸ˆ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="offeringModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ’³ ëª¨ë°”ì¼ í—Œê¸ˆ ì„¤ì •</span>
                <button class="modal-close" onclick="closeOfferingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ê²°ì œ ë°©ì‹</label>
                    <select class="form-select" id="offeringMethod">
                        <option value="account">ê³„ì¢Œì´ì²´ ì•ˆë‚´</option>
                        <option value="kakaopay">ì¹´ì¹´ì˜¤í˜ì´</option>
                        <option value="naverpay">ë„¤ì´ë²„í˜ì´</option>
                        <option value="toss">í† ìŠ¤</option>
                    </select>
                </div>
                <div class="form-group" id="accountInfoGroup">
                    <label class="form-label">ê³„ì¢Œ ì •ë³´</label>
                    <input type="text" class="form-input" id="offeringBank" placeholder="ì€í–‰ëª…" style="margin-bottom: 8px;">
                    <input type="text" class="form-input" id="offeringAccount" placeholder="ê³„ì¢Œë²ˆí˜¸" style="margin-bottom: 8px;">
                    <input type="text" class="form-input" id="offeringHolder" placeholder="ì˜ˆê¸ˆì£¼">
                </div>
                <div class="form-group">
                    <label class="form-label">í—Œê¸ˆ ì¢…ë¥˜ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" value="ì‹­ì¼ì¡°" checked> ì‹­ì¼ì¡°
                        </label>
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" value="ê°ì‚¬í—Œê¸ˆ"> ê°ì‚¬í—Œê¸ˆ
                        </label>
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" value="ì„ êµí—Œê¸ˆ"> ì„ êµí—Œê¸ˆ
                        </label>
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" value="ê±´ì¶•í—Œê¸ˆ"> ê±´ì¶•í—Œê¸ˆ
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeOfferingModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertOfferingSection()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <!-- SNS ë§í¬ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="snsModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ“± SNS ë§í¬ ë“±ë¡</span>
                <button class="modal-close" onclick="closeSnsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="sns-item">
                    <div class="sns-icon youtube">â–¶</div>
                    <input type="text" class="form-input" id="snsYoutube" placeholder="YouTube ì±„ë„ URL" style="flex: 1;">
                </div>
                <div class="sns-item">
                    <div class="sns-icon instagram">ğŸ“·</div>
                    <input type="text" class="form-input" id="snsInstagram" placeholder="Instagram URL" style="flex: 1;">
                </div>
                <div class="sns-item">
                    <div class="sns-icon facebook">f</div>
                    <input type="text" class="form-input" id="snsFacebook" placeholder="Facebook URL" style="flex: 1;">
                </div>
                <div class="sns-item">
                    <div class="sns-icon kakao">ğŸ’¬</div>
                    <input type="text" class="form-input" id="snsKakao" placeholder="ì¹´ì¹´ì˜¤í†¡ ì±„ë„ URL" style="flex: 1;">
                </div>
                <div class="sns-item">
                    <div class="sns-icon naver">N</div>
                    <input type="text" class="form-input" id="snsNaver" placeholder="ë„¤ì´ë²„ ì¹´í˜/ë¸”ë¡œê·¸ URL" style="flex: 1;">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label class="form-label">í‘œì‹œ ìŠ¤íƒ€ì¼</label>
                    <select class="form-select" id="snsStyle">
                        <option value="icons">ì•„ì´ì½˜ë§Œ</option>
                        <option value="buttons">ë²„íŠ¼í˜•</option>
                        <option value="list">ëª©ë¡í˜•</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeSnsModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="insertSnsLinks()">ì‚½ì…</button>
            </div>
        </div>
    </div>

    <script>
        // =========================================
        // ì „ì—­ ë³€ìˆ˜
        // =========================================
        let currentFile = null;
        let originalContent = '';
        let currentPath = 'Church';  // ì£¼ë³´ëŠ” Church í´ë” ê¸°ë³¸
        let previewUpdateTimer = null;
        let selectedHymnData = null;

        // ì°¬ì†¡ê°€ ë°ì´í„° (ì¼ë¶€ ì˜ˆì‹œ)
        const hymnData = [
            { number: 1, title: 'ë§Œë³µì˜ ê·¼ì› í•˜ë‚˜ë‹˜' },
            { number: 21, title: 'ë‹¤ ì°¬ì–‘í•˜ì—¬ë¼' },
            { number: 79, title: 'ì£¼ í•˜ë‚˜ë‹˜ ì§€ìœ¼ì‹  ëª¨ë“  ì„¸ê³„' },
            { number: 218, title: 'ë„¤ ë§˜ê³¼ ì •ì„±ì„ ë‹¤í•˜ì—¬ì„œ' },
            { number: 288, title: 'ì˜ˆìˆ˜ ì‚¬ë‘í•˜ì‹¬ì€' },
            { number: 305, title: 'ë‚˜ ê°™ì€ ì£„ì¸ ì‚´ë¦¬ì‹ ' },
            { number: 488, title: 'ì‹­ìê°€ êµ°ë³‘ ë˜ì–´ì„œ' },
            { number: 558, title: 'ì£¼ì˜ ì¹œì ˆí•œ íŒ”ì— ì•ˆê¸°ì„¸' },
            { number: 635, title: 'í•˜ëŠ˜ì— ê³„ì‹  (ì£¼ê¸°ë„ë¬¸)' },
        ];

        // =========================================
        // ì´ˆê¸°í™”
        // =========================================
        document.addEventListener('DOMContentLoaded', () => {
            loadFiles();
            setupResizer();
            setupEditorEvents();
        });

        // =========================================
        // íŒŒì¼ íƒìƒ‰ê¸°
        // =========================================
        async function loadFiles() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“‚ ë¡œë”© ì¤‘...</div>';
            updateBreadcrumb();

            try {
                let apiUrl = '/api/files/outputs';
                if (currentPath) {
                    // í•œê¸€ ê²½ë¡œ ì¸ì½”ë”© ì²˜ë¦¬
                    const encodedPath = currentPath.split('/').map(p => encodeURIComponent(p)).join('/');
                    apiUrl += '/' + encodedPath;
                }
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.success) {
                    displayFiles(data.folders || [], data.files || []);
                } else {
                    fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                fileList.innerHTML = `<div style="padding: 20px; text-align: center; color: var(--danger);">âŒ ë¡œë“œ ì‹¤íŒ¨</div>`;
            }
        }

        function displayFiles(folders, files) {
            const fileList = document.getElementById('fileList');
            if (folders.length === 0 && files.length === 0) {
                fileList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-gray);">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            let html = '';

            // í´ë”
            folders.forEach(folder => {
                const folderName = typeof folder === 'string' ? folder : folder.name;
                const folderPath = currentPath ? currentPath + '/' + folderName : folderName;
                const fileCount = folder.file_count || 0;
                html += `
                    <div class="folder-item" onclick="navigateTo('${folderPath}')">
                        <span>ğŸ“</span>
                        <span class="folder-name">${folderName}</span>
                        ${fileCount > 0 ? `<span style="margin-left: auto; font-size: 0.75em; color: #92400E;">(${fileCount})</span>` : ''}
                    </div>
                `;
            });

            // íŒŒì¼
            files.forEach(file => {
                const filePath = currentPath ? 'outputs/' + currentPath + '/' + file.name : file.name;
                const isActive = currentFile === filePath;
                html += `
                    <div class="file-item ${isActive ? 'active' : ''}" onclick="loadFile('${filePath}')">
                        <div class="file-name">${file.name}</div>
                        <div class="file-time">${new Date(file.modified).toLocaleString()}</div>
                    </div>
                `;
            });

            fileList.innerHTML = html;
        }

        function navigateTo(path) {
            currentPath = path;
            loadFiles();
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!currentPath) {
                breadcrumb.innerHTML = '<span class="breadcrumb-current">ğŸ“ outputs</span>';
                return;
            }

            const parts = currentPath.split('/').filter(p => p);
            let html = '<span class="breadcrumb-item" onclick="navigateTo(\'\')">ğŸ“ outputs</span>';

            let accumulated = '';
            parts.forEach((part, idx) => {
                html += '<span class="breadcrumb-separator">/</span>';
                accumulated += (accumulated ? '/' : '') + part;
                if (idx === parts.length - 1) {
                    html += `<span class="breadcrumb-current">${part}</span>`;
                } else {
                    html += `<span class="breadcrumb-item" onclick="navigateTo('${accumulated}')">${part}</span>`;
                }
            });

            breadcrumb.innerHTML = html;
        }

        // =========================================
        // íŒŒì¼ ë¡œë“œ/ì €ì¥
        // =========================================
        async function loadFile(filename) {
            try {
                const response = await fetch(`/api/editor/file/${encodeURIComponent(filename)}`);
                const data = await response.json();

                if (data.success) {
                    currentFile = filename;
                    originalContent = data.content;
                    document.getElementById('htmlEditor').value = data.content;
                    document.getElementById('currentFileInfo').textContent = filename.split('/').pop();
                    document.getElementById('statusText').textContent = `${filename} ë¡œë“œë¨`;
                    updatePreview();
                    updateCharCount();

                    // íŒŒì¼ ëª©ë¡ ê°±ì‹  (active í‘œì‹œ)
                    loadFiles();
                } else {
                    showNotification('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜', 'error');
            }
        }

        async function saveFile() {
            if (!currentFile) {
                showNotification('ì €ì¥í•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const content = document.getElementById('htmlEditor').value;

            try {
                const response = await fetch('/api/editor/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename: currentFile, content })
                });

                const data = await response.json();
                if (data.success) {
                    originalContent = content;
                    showNotification('ì €ì¥ ì™„ë£Œ!', 'success');
                    document.getElementById('statusText').textContent = 'ì €ì¥ë¨';
                } else {
                    showNotification('ì €ì¥ ì‹¤íŒ¨: ' + data.detail, 'error');
                }
            } catch (error) {
                showNotification('ì €ì¥ ì˜¤ë¥˜', 'error');
            }
        }

        function downloadFile() {
            if (!currentFile) {
                showNotification('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const content = document.getElementById('htmlEditor').value;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile.split('/').pop();
            a.click();
            URL.revokeObjectURL(url);
            showNotification('ë‹¤ìš´ë¡œë“œ ì‹œì‘!', 'success');
        }

        async function downloadWithImages() {
            if (!currentFile) {
                showNotification('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            try {
                showNotification('ZIP ìƒì„± ì¤‘...', 'info');
                const response = await fetch(`/api/editor/download-zip/${encodeURIComponent(currentFile)}`);

                if (!response.ok) throw new Error('ZIP ìƒì„± ì‹¤íŒ¨');

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = currentFile.split('/').pop().replace('.html', '.zip');
                a.click();
                URL.revokeObjectURL(url);
                showNotification('ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success');
            } catch (error) {
                showNotification('ZIP ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // =========================================
        // ì—ë””í„° ê¸°ëŠ¥
        // =========================================
        function setupEditorEvents() {
            const editor = document.getElementById('htmlEditor');

            editor.addEventListener('input', () => {
                updateCharCount();
                schedulePreviewUpdate();
            });

            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
            editor.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 's') {
                        e.preventDefault();
                        saveFile();
                    }
                }
            });
        }

        function updateCharCount() {
            const count = document.getElementById('htmlEditor').value.length;
            document.getElementById('charCount').textContent = `${count.toLocaleString()}ì`;
        }

        function schedulePreviewUpdate() {
            clearTimeout(previewUpdateTimer);
            previewUpdateTimer = setTimeout(updatePreview, 300);
        }

        function updatePreview() {
            const content = document.getElementById('htmlEditor').value;
            const frame = document.getElementById('previewFrame');
            const doc = frame.contentDocument || frame.contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
        }

        function setPreviewSize(size) {
            const device = document.getElementById('previewDevice');
            device.className = 'preview-device ' + size;

            document.querySelectorAll('.preview-size-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(size === 'desktop' ? 'ğŸ–¥ï¸' : size === 'mobile' ? 'ğŸ“±' : 'ğŸ“Ÿ')) {
                    btn.classList.add('active');
                }
            });
        }

        // =========================================
        // ë¦¬ì‚¬ì´ì €
        // =========================================
        function setupResizer() {
            const resizer = document.getElementById('resizer');
            const editorPane = document.getElementById('editorPane');
            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const containerRect = document.querySelector('.split-view').getBoundingClientRect();
                const newWidth = e.clientX - containerRect.left;
                editorPane.style.flex = 'none';
                editorPane.style.width = Math.max(300, Math.min(newWidth, containerRect.width - 300)) + 'px';
            });

            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = '';
            });
        }

        // =========================================
        // ì‚¬ì´ë“œë°” íƒ­
        // =========================================
        function switchSidebarTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.sidebar-tab[onclick="switchSidebarTab('${tab}')"]`).classList.add('active');

            document.getElementById('filesPanel').style.display = tab === 'files' ? 'flex' : 'none';
            document.getElementById('toolsPanel').classList.toggle('active', tab === 'tools');
        }

        function toggleToolSection(header) {
            const section = header.parentElement;
            const isOpen = section.classList.contains('open');

            // ë‹¤ë¥¸ ì„¹ì…˜ ë‹«ê¸°
            document.querySelectorAll('.tool-section').forEach(s => s.classList.remove('open'));

            if (!isOpen) {
                section.classList.add('open');
                header.querySelector('span:last-child').textContent = 'â–¼';
            }

            // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tool-section-header span:last-child').forEach(icon => {
                icon.textContent = icon.closest('.tool-section').classList.contains('open') ? 'â–¼' : 'â–¶';
            });
        }

        // =========================================
        // ì•Œë¦¼
        // =========================================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.innerHTML = `<span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span> ${message}`;
            notification.className = `notification show ${type}`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // =========================================
        // ê³µí†µ í…ìŠ¤íŠ¸ í¬ë§·
        // =========================================
        function formatText(type) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);

            let wrapper;
            switch (type) {
                case 'bold': wrapper = ['<strong>', '</strong>']; break;
                case 'italic': wrapper = ['<em>', '</em>']; break;
                case 'underline': wrapper = ['<u>', '</u>']; break;
            }

            const newText = wrapper[0] + selectedText + wrapper[1];
            editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
            editor.focus();
            updatePreview();
        }

        function insertElement(tag) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const selectedText = editor.value.substring(start, editor.selectionEnd) || 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”';

            const newText = `<${tag}>${selectedText}</${tag}>\n`;
            editor.value = editor.value.substring(0, start) + newText + editor.value.substring(editor.selectionEnd);
            editor.focus();
            updatePreview();
        }

        function beautifyHTML() {
            const editor = document.getElementById('htmlEditor');
            let html = editor.value;

            // ê°„ë‹¨í•œ HTML ì •ë¦¬
            html = html.replace(/></g, '>\n<');
            html = html.replace(/\n\s*\n/g, '\n');

            editor.value = html;
            updatePreview();
            showNotification('ì½”ë“œ ì •ë¦¬ ì™„ë£Œ', 'success');
        }

        function findReplace() {
            const find = prompt('ì°¾ì„ í…ìŠ¤íŠ¸:');
            if (!find) return;

            const replace = prompt('ë°”ê¿€ í…ìŠ¤íŠ¸:');
            if (replace === null) return;

            const editor = document.getElementById('htmlEditor');
            const count = (editor.value.match(new RegExp(find, 'g')) || []).length;
            editor.value = editor.value.split(find).join(replace);
            updatePreview();
            showNotification(`${count}ê°œ í•­ëª© êµì²´ë¨`, 'success');
        }

        // =========================================
        // ì„±ê²½ êµ¬ì ˆ ëª¨ë‹¬
        // =========================================
        function openBibleModal() {
            document.getElementById('bibleModal').classList.add('active');
        }

        function closeBibleModal() {
            document.getElementById('bibleModal').classList.remove('active');
        }

        function insertBibleVerse() {
            const book = document.getElementById('bibleBook').value;
            const chapter = document.getElementById('bibleChapter').value;
            const verse = document.getElementById('bibleVerse').value;
            const style = document.getElementById('bibleStyle').value;

            if (!book || !chapter || !verse) {
                showNotification('ì„±ê²½ êµ¬ì ˆì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            const reference = `${book} ${chapter}:${verse}`;
            let html = '';

            if (style === 'link') {
                html = `<a href="https://www.bskorea.or.kr/bible/korbibReadpage.php?version=GAE&book=${book}&chap=${chapter}&sec=${verse}" target="_blank" class="bible-link">${reference}</a>`;
            } else if (style === 'inline') {
                html = `<span class="bible-verse"><strong>${reference}</strong></span>`;
            } else {
                html = `
<div class="bible-card" style="background: linear-gradient(135deg, #f5f0e8 0%, #e8e0d5 100%); padding: 20px; border-radius: 12px; margin: 15px 0; border-left: 4px solid #8B4513;">
    <div style="font-weight: 700; color: #8B4513; margin-bottom: 10px;">${reference}</div>
    <div style="font-style: italic; color: #5D4037; line-height: 1.8;">ë³¸ë¬¸ ë‚´ìš©ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”</div>
</div>`;
            }

            insertAtCursor(html);
            closeBibleModal();
            showNotification('ì„±ê²½ êµ¬ì ˆ ì‚½ì…ë¨', 'success');
        }

        // =========================================
        // ì°¬ì†¡ê°€ ëª¨ë‹¬
        // =========================================
        function openHymnModal() {
            document.getElementById('hymnModal').classList.add('active');
            document.getElementById('hymnSearch').value = '';
            document.getElementById('hymnSearchResult').style.display = 'none';
            selectedHymnData = null;
            document.getElementById('selectedHymn').textContent = 'ì°¬ì†¡ê°€ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”';
        }

        function closeHymnModal() {
            document.getElementById('hymnModal').classList.remove('active');
        }

        function searchHymn() {
            const query = document.getElementById('hymnSearch').value.trim().toLowerCase();
            const resultDiv = document.getElementById('hymnSearchResult');

            if (!query) {
                resultDiv.style.display = 'none';
                return;
            }

            const results = hymnData.filter(h =>
                h.number.toString().includes(query) ||
                h.title.toLowerCase().includes(query)
            );

            if (results.length > 0) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = results.map(h => `
                    <div class="hymn-item" onclick="selectHymn(${h.number}, '${h.title}')">
                        <span class="hymn-number">${h.number}ì¥</span>
                        <span>${h.title}</span>
                    </div>
                `).join('');
            } else {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '<div style="padding: 15px; text-align: center; color: var(--text-gray);">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';
            }
        }

        function selectHymn(number, title) {
            selectedHymnData = { number, title };
            document.getElementById('selectedHymn').innerHTML = `<span class="hymn-number">${number}ì¥</span> ${title}`;
            document.getElementById('hymnSearchResult').style.display = 'none';
        }

        function insertHymnLink() {
            if (!selectedHymnData) {
                showNotification('ì°¬ì†¡ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const linkType = document.getElementById('hymnLinkType').value;
            const youtubeSearch = `https://www.youtube.com/results?search_query=ì°¬ì†¡ê°€+${selectedHymnData.number}ì¥+${encodeURIComponent(selectedHymnData.title)}`;

            const html = `
<a href="${youtubeSearch}" target="_blank" class="hymn-link" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #FEF3C7; color: #92400E; text-decoration: none; border-radius: 20px; font-weight: 500;">
    <span>ğŸµ</span>
    <span>${selectedHymnData.number}ì¥ ${selectedHymnData.title}</span>
    <span style="font-size: 0.8em;">â–¶</span>
</a>`;

            insertAtCursor(html);
            closeHymnModal();
            showNotification('ì°¬ì†¡ê°€ ë§í¬ ì‚½ì…ë¨', 'success');
        }

        function openHymnSheetModal() {
            // TODO: ì•…ë³´ í¬í•¨ ëª¨ë‹¬ êµ¬í˜„
            showNotification('ì•…ë³´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        // =========================================
        // ì„¤êµ ì˜¤ë””ì˜¤ ëª¨ë‹¬
        // =========================================
        function openSermonModal() {
            document.getElementById('sermonModal').classList.add('active');
        }

        function closeSermonModal() {
            document.getElementById('sermonModal').classList.remove('active');
        }

        function insertSermonPlayer() {
            const source = document.getElementById('sermonSource').value;
            const url = document.getElementById('sermonUrl').value;
            const title = document.getElementById('sermonTitle').value || 'ì„¤êµ';
            const speaker = document.getElementById('sermonSpeaker').value || '';
            const includeDownload = document.getElementById('sermonDownload').checked;

            if (!url && source !== 'upload') {
                showNotification('ì˜¤ë””ì˜¤ URLì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            let html = `
<div class="sermon-player" style="background: linear-gradient(135deg, #f5f0e8 0%, #e8e0d5 100%); padding: 20px; border-radius: 12px; margin: 15px 0;">
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
        <div style="width: 60px; height: 60px; background: #8B4513; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em;">ğŸ¤</div>
        <div>
            <div style="font-weight: 700; color: #2C1810; font-size: 1.1em;">${title}</div>
            ${speaker ? `<div style="color: #5D4037; font-size: 0.9em;">${speaker}</div>` : ''}
        </div>
    </div>
    <audio controls style="width: 100%; border-radius: 8px;">
        <source src="${url || '#'}" type="audio/mpeg">
        ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>
    ${includeDownload ? `
    <div style="margin-top: 10px; text-align: right;">
        <a href="${url || '#'}" download style="color: #8B4513; font-size: 0.85em; text-decoration: none;">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
    </div>` : ''}
</div>`;

            insertAtCursor(html);
            closeSermonModal();
            showNotification('ì„¤êµ í”Œë ˆì´ì–´ ì‚½ì…ë¨', 'success');
        }

        function openVideoModal() {
            showNotification('ì˜ìƒ ì‚½ì… ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        // =========================================
        // í—Œê¸ˆ ëª¨ë‹¬
        // =========================================
        function openOfferingModal() {
            document.getElementById('offeringModal').classList.add('active');
        }

        function closeOfferingModal() {
            document.getElementById('offeringModal').classList.remove('active');
        }

        function insertOfferingSection() {
            const method = document.getElementById('offeringMethod').value;
            const bank = document.getElementById('offeringBank').value;
            const account = document.getElementById('offeringAccount').value;
            const holder = document.getElementById('offeringHolder').value;

            let html = `
<div class="offering-section" style="background: linear-gradient(135deg, #fff9e6 0%, #f5f0e8 100%); padding: 25px; border-radius: 16px; margin: 20px 0; text-align: center;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ’°</div>
    <div style="font-weight: 700; color: #8B4513; font-size: 1.2em; margin-bottom: 15px;">í—Œê¸ˆ ì•ˆë‚´</div>

    <div style="background: white; padding: 15px 20px; border-radius: 10px; display: inline-block; margin-bottom: 15px;">
        <div style="color: #5D4037; font-size: 0.9em; margin-bottom: 5px;">${bank || 'ì€í–‰ëª…'}</div>
        <div style="font-size: 1.3em; font-weight: 700; color: #2C1810; letter-spacing: 1px;" onclick="copyAccount('${account}')" style="cursor: pointer;">
            ${account || 'ê³„ì¢Œë²ˆí˜¸'}
        </div>
        <div style="color: #8D6E63; font-size: 0.85em; margin-top: 5px;">ì˜ˆê¸ˆì£¼: ${holder || 'ì˜ˆê¸ˆì£¼ëª…'}</div>
    </div>

    <div>
        <button onclick="copyAccount('${account}')" style="padding: 10px 20px; background: #8B4513; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
            ğŸ“‹ ê³„ì¢Œë²ˆí˜¸ ë³µì‚¬
        </button>
    </div>
</div>

<script>
function copyAccount(account) {
    navigator.clipboard.writeText(account).then(() => {
        alert('ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
}
<\/script>`;

            insertAtCursor(html);
            closeOfferingModal();
            showNotification('í—Œê¸ˆ ì„¹ì…˜ ì‚½ì…ë¨', 'success');
        }

        function openAccountModal() {
            openOfferingModal();
        }

        // =========================================
        // SNS ëª¨ë‹¬
        // =========================================
        function openSnsModal() {
            document.getElementById('snsModal').classList.add('active');
        }

        function closeSnsModal() {
            document.getElementById('snsModal').classList.remove('active');
        }

        function insertSnsLinks() {
            const youtube = document.getElementById('snsYoutube').value;
            const instagram = document.getElementById('snsInstagram').value;
            const facebook = document.getElementById('snsFacebook').value;
            const kakao = document.getElementById('snsKakao').value;
            const naver = document.getElementById('snsNaver').value;
            const style = document.getElementById('snsStyle').value;

            const links = [];
            if (youtube) links.push({ icon: 'â–¶', name: 'YouTube', url: youtube, bg: '#FF0000' });
            if (instagram) links.push({ icon: 'ğŸ“·', name: 'Instagram', url: instagram, bg: 'linear-gradient(45deg, #833AB4, #FD1D1D, #FCAF45)' });
            if (facebook) links.push({ icon: 'f', name: 'Facebook', url: facebook, bg: '#1877F2' });
            if (kakao) links.push({ icon: 'ğŸ’¬', name: 'ì¹´ì¹´ì˜¤í†¡', url: kakao, bg: '#FEE500', color: '#3C1E1E' });
            if (naver) links.push({ icon: 'N', name: 'ë„¤ì´ë²„', url: naver, bg: '#03C75A' });

            if (links.length === 0) {
                showNotification('ìµœì†Œ í•˜ë‚˜ì˜ SNSë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            let html = '<div class="sns-links" style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin: 20px 0;">\n';

            links.forEach(link => {
                if (style === 'icons') {
                    html += `    <a href="${link.url}" target="_blank" style="width: 45px; height: 45px; background: ${link.bg}; color: ${link.color || 'white'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-weight: 700;">${link.icon}</a>\n`;
                } else {
                    html += `    <a href="${link.url}" target="_blank" style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: ${link.bg}; color: ${link.color || 'white'}; border-radius: 8px; text-decoration: none; font-weight: 600;"><span>${link.icon}</span><span>${link.name}</span></a>\n`;
                }
            });

            html += '</div>';

            insertAtCursor(html);
            closeSnsModal();
            showNotification('SNS ë§í¬ ì‚½ì…ë¨', 'success');
        }

        function openContactModal() {
            showNotification('ì—°ë½ì²˜ ì¹´ë“œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        // =========================================
        // AI ì±„íŒ…
        // =========================================
        function toggleAiChat() {
            const panel = document.getElementById('aiChatPanel');
            const fab = document.getElementById('aiFab');
            panel.classList.toggle('active');
            fab.classList.toggle('hidden', panel.classList.contains('active'));
        }

        function handleAiInputKeypress(e) {
            if (e.key === 'Enter') {
                sendAiMessage();
            }
        }

        async function sendAiMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById('aiChatMessages');

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            messagesDiv.innerHTML += `<div class="ai-message user">${message}</div>`;
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // AI ì‘ë‹µ (ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ)
            messagesDiv.innerHTML += `<div class="ai-message assistant">ìš”ì²­ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>`;

            try {
                const htmlContent = document.getElementById('htmlEditor').value;
                const response = await fetch('/api/ai/edit-html', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        html_content: htmlContent,
                        instruction: message,
                        content_type: 'church'
                    })
                });

                const data = await response.json();

                // ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                const lastMsg = messagesDiv.lastElementChild;

                if (data.success) {
                    document.getElementById('htmlEditor').value = data.html;
                    updatePreview();
                    lastMsg.textContent = 'ìˆ˜ì •ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else {
                    lastMsg.textContent = 'ì£„ì†¡í•©ë‹ˆë‹¤. ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                    lastMsg.classList.add('error');
                }
            } catch (error) {
                const lastMsg = messagesDiv.lastElementChild;
                lastMsg.textContent = 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                lastMsg.classList.add('error');
            }

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // =========================================
        // ìœ í‹¸ë¦¬í‹°
        // =========================================
        function insertAtCursor(text) {
            const editor = document.getElementById('htmlEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;

            editor.value = editor.value.substring(0, start) + text + editor.value.substring(end);
            editor.selectionStart = editor.selectionEnd = start + text.length;
            editor.focus();
            updatePreview();
            updateCharCount();
        }
    </script>
</body>
</html>
